<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>oded.dev</title><meta content="width=device-width,initial-scale=1,maximum-scale=1" name="viewport"><link href="https://oded.dev/atom.xml" rel="alternate" type="application/atom+xml" title="oded.dev"><link href="/fonts/fontawesome/fontawesome.woff" rel="preload" type="font/woff" as="font" crossorigin><link href="/fonts/fontawesome/fontawesome.ttf" rel="preload" type="font/ttf" as="font" crossorigin><link href="/fonts/open-sans/open-sans.woff2" rel="preload" type="font/woff2" as="font" crossorigin><link href="/fonts/open-sans/open-sans-semi-bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin><link href="/fonts/open-sans/open-sans-italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin><link href="/fonts/source-code-pro/source-code-pro.woff2" rel="preload" type="font/woff2" as="font" crossorigin><style>@font-face{font-family:FontAwesome;src:url(https://oded.dev/fonts/fontawesome/fontawesome.ttf) format('truetype'),url(https://oded.dev/fonts/fontsawesome/fontawesome.woff) format('woff');font-weight:400;font-style:normal}[class*=" fa-"],[class^=fa-]{font-family:FontAwesome!important;speak:none;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-search:before{content:"\f002"}.fa-tag:before{content:"\f02b"}.fa-map-marker:before{content:"\f041"}.fa-arrow-up:before{content:"\f062"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-calendar:before{content:"\f073"}.fa-folder:before{content:"\f07b"}.fa-twitter:before{content:"\f099"}.fa-facebook-f:before,.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-feed:before,.fa-rss:before{content:"\f09e"}.fa-pinterest:before{content:"\f0d2"}.fa-google-plus:before{content:"\f0d5"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-right:before{content:"\f0da"}.fa-linkedin:before{content:"\f0e1"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-google:before{content:"\f1a0"}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;src:local('Open Sans'),local('OpenSans'),url(https://oded.dev/fonts/open-sans/open-sans.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215,U+E0FF,U+EFFD,U+F000}@font-face{font-family:'Open Sans';font-style:normal;font-weight:600;src:local('Open Sans Semibold'),local('OpenSans-Semibold'),url(https://oded.dev/fonts/open-sans/open-sans-semi-bold.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215,U+E0FF,U+EFFD,U+F000}@font-face{font-family:'Open Sans';font-style:italic;font-weight:400;src:local('Open Sans Italic'),local('OpenSans-Italic'),url(https://oded.dev/fonts/open-sans/open-sans-italic.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215,U+E0FF,U+EFFD,U+F000}@font-face{font-family:'Source Code Pro';font-style:normal;font-weight:400;src:local('Source Code Pro'),local('SourceCodePro-Regular'),url(https://oded.dev/fonts/source-code-pro/source-code-pro.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2212,U+2215,U+E0FF,U+EFFD,U+F000}</style><style>.highlight{margin:0;display:block;overflow-x:auto;padding:15px 20px;font-size:14px;font-family:"Source Code Pro",Consolas,Monaco,Menlo,Consolas,monospace;line-height:22.400000000000002px;color:#333;background:#f8f8f8}.highlight table{margin:0!important;width:auto}.highlight table td{border:0}.highlight table td.code{padding-right:20px}.highlight .gutter pre{color:#666;text-align:right;padding-right:20px}.article-entry .highlight{margin:1.6em 0}.article-entry .highlight .line{height:1.6em}.highlight .code .comment,.highlight .code .quote{color:#998;font-style:italic}.highlight .code .keyword,.highlight .code .selector-tag{color:#333;font-weight:700}.highlight .code .subst{color:#333}.highlight .code .literal,.highlight .code .number,.highlight .code .tag .attr,.highlight .code .template-variable,.highlight .code .variable{color:teal}.highlight .code .doctag,.highlight .code .string{color:#d14}.highlight .code .section,.highlight .code .selector-id,.highlight .code .title{color:#900;font-weight:700}.highlight .code .subst{font-weight:400}.highlight .code .class .title,.highlight .code .type{color:#458;font-weight:700}.highlight .code .attribute,.highlight .code .name,.highlight .code .tag{color:navy;font-weight:400}.highlight .code .link,.highlight .code .regexp{color:#009926}.highlight .code .bullet,.highlight .code .symbol{color:#990073}.highlight .code .built_in,.highlight .code .builtin-name{color:#0086b3}.highlight .code .meta{color:#999;font-weight:700}.highlight .code .deletion{background:#fdd}.highlight .code .addition{background:#dfd}.highlight .code .emphasis{font-style:italic}.highlight .code .strong{font-weight:700}</style><style>#profile .inner .social-links>table,body{width:100%}.outer:after,.outer:before,body:after,body:before{content:"";display:table}.outer:after,body:after{clear:both}a,abbr,acronym,address,applet,big,blockquote,cite,dd,del,dfn,div,dl,dt,em,fieldset,form,h1,h2,h3,h4,h5,h6,html,iframe,img,ins,kbd,label,legend,li,object,ol,p,pre,q,s,samp,small,span,strike,strong,sub,sup,tbody,tfoot,thead,tr,tt,ul,var{margin:0;padding:0;border:0;outline:0;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline}body,caption,td,th{margin:0;padding:0;border:0}body{outline:0;line-height:1;background:#fff}caption,code,table,td,th{outline:0;font-style:inherit}caption,td,th{font-family:inherit;font-size:100%}code,table{font-weight:inherit}body,code{vertical-align:baseline}caption,table,td,th{vertical-align:middle}table{font-family:inherit;font-size:100%;border-collapse:separate;border-spacing:0}.layout-wrap-inner.list-categories ul ol,.layout-wrap-inner.list-categories ul ul,ol,ul{list-style:none}caption,td,th{text-align:left;font-weight:400}.article-entry iframe,.layout-wrap-inner.list-categories ul ol li,.layout-wrap-inner.list-categories ul ul li,.widget ol ol li,.widget ol ul li,.widget ul ol li,.widget ul ul li,a img,code,table{border:0}button,input,table{margin:0;padding:0}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}#container,body,html{height:100%}body{color:#565a5f;background:#f5f8f9;font:14px "open sans","Helvetica Neue","Microsoft Yahei",Helvetica,Arial,sans-serif;-webkit-text-size-adjust:100%}a{text-decoration:none}a,a:visited{color:#38b7ea}code{margin:0 2px;color:#e96900;padding:3px 5px;font-size:.9em;border-radius:2px;font-family:"Source Code Pro",Consolas,Monaco,Menlo,Consolas,monospace;background-color:#f8f8f8}.outer{max-width:1320px;margin:0 auto;padding:0 20px}@media screen and (max-width:559px){.outer{padding:0}}.alignleft,.left{float:left}.alignright,.right{float:right}.clear{clear:both}.logo{width:40px;height:40px;background-repeat:no-repeat;background-image:url();background-size:40px 40px}#container{position:relative}#container>.outer{margin-bottom:30px}@media screen and (min-width:1200px){#main{display:inline;float:left;width:52.307692307692314%;margin:0 .769230769230769%}}@media screen and (min-width:800px) and (max-width:1199px){#main{display:inline;float:left;width:67.6923076923077%;margin:0 .769230769230769%}}@media screen and (min-width:560px) and (max-width:799px){#main{width:100%}}@media screen and (max-width:559px){#main{width:100%}}#header a,#header a:visited,.archive-article-header a,.archive-article-header a:visited,.layout-wrap-inner.tag-cloud a,.layout-wrap-inner.tag-cloud a:visited,.timeline-row .content h1 a,.timeline-row .content h1 a:visited{color:#565a5f;transition:.2s ease}.archive-article-header a:hover,.archive-article-header a:visited:hover,.layout-wrap-inner.tag-cloud a:hover,.layout-wrap-inner.tag-cloud a:visited:hover,.timeline-row .content h1 a:hover,.timeline-row .content h1 a:visited:hover{color:#38b7ea}.archive-year{line-height:1em}.archive-year,.article-meta,.widget-title{text-decoration:none;text-transform:uppercase}.widget-title{line-height:1em}#comments{background:#fff}#comments,#header,#profile .inner{box-shadow:0 1px 2px rgba(0,0,0,.05)}#toTop,.archive-article,.article-inner,.timeline-row .content{background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.05)}.article-entry h1,.widget h1{font-size:2em}.article-entry h2,.widget h2{font-size:1.5em}.article-entry h3,.widget h3{font-size:1.3em}.article-entry h4,.widget h4{font-size:1.2em}.article-entry h5,.widget h5{font-size:1em}.article-entry h6,.widget h6{font-size:1em;color:#999}.article-entry hr,.widget hr{border:1px dashed #eceff2}.article-entry dt,.article-entry h1,.article-entry h2,.article-entry h3,.article-entry h4,.article-entry h5,.article-entry h6,.article-entry strong,.widget dt,.widget strong{font-weight:700}.article-entry cite,.article-entry em,.widget cite,.widget em{font-style:italic}.article-entry sub,.article-entry sup,.widget sub,.widget sup{font-size:.75em;line-height:0;position:relative;vertical-align:baseline}.article-entry sup,.widget sup{top:-.5em}.article-entry sub,.widget sub{bottom:-.2em}.article-entry small,.widget small{font-size:.85em}.article-entry abbr,.article-entry acronym,.widget abbr,.widget acronym{border-bottom:1px dotted}.article-entry dl,.article-entry ol,.article-entry ul,.widget dl{margin:0 20px;line-height:1.6em}.widget ol,.widget ul{line-height:1.6em}.article-entry ol ol,.article-entry ol ul,.article-entry ul ol,.article-entry ul ul{margin-top:0;margin-bottom:0}.article-entry ul{list-style:disc}.article-entry ol{list-style:decimal}#header{background:#fff;position:relative}#header a,#header a:visited{white-space:nowrap}#header a:hover{color:#38b7ea}#main-nav,#search-form-wrap,#sub-nav,.header-inner #logo{height:40px;line-height:40px;padding:12px 15px}#main-nav,#sub-nav #profile-nav .avatar,#sub-nav #profile-nav .fa,.header-inner #logo{float:left}#search-form-wrap,#sub-nav{float:right}.header-inner{height:100%;position:relative}.header-inner #logo{display:inline-block}.header-inner #logo .logo{margin-right:5px;display:inline-block}.header-inner #logo .site-title{font-size:16px;display:inline-block;vertical-align:top;font-weight:600}#header-title{text-align:center;height:40px;position:absolute;top:50%;left:0;margin-top:-20px}.header-sub{border-top:1px solid #eceff2}.header-sub ul{margin:0 15px}#main-nav-mobile .menu:after,#main-nav-mobile .menu:before,#sub-nav #profile-nav #profile-anchor:after,#sub-nav #profile-nav #profile-anchor:before,.header-sub ul:after,.header-sub ul:before{content:"";display:table}#main-nav-mobile .menu:after,#sub-nav #profile-nav #profile-anchor:after,.header-sub ul:after{clear:both}.header-sub ul li{float:left;margin:0 10px}.header-sub .main-nav-link,.header-sub ul li a{display:inline-block;line-height:48px}@media screen and (min-width:560px) and (max-width:799px){#header-sub{display:none}}@media screen and (max-width:559px){#header-sub{display:none}}@media screen and (min-width:560px) and (max-width:799px){#main-nav{display:none}}@media screen and (max-width:559px){#main-nav{display:none}}@media screen and (min-width:800px) and (max-width:1199px){#main-nav-mobile{display:none}}@media screen and (min-width:1200px){#main-nav-mobile{display:none}}.main-nav-link,.nav-icon{float:left;display:block;padding:0 15px}.nav-icon{text-align:center;font-size:14px;width:14px;position:relative;cursor:pointer;height:40px!important;line-height:40px!important}.main-nav-link{font-weight:300}@media screen and (min-width:1200px){#sub-nav{display:none}}#sub-nav #profile-nav #profile-anchor{display:block;height:40px;line-height:40px}#sub-nav #profile-nav .avatar{width:40px;height:40px;margin-right:8px}#sub-nav #profile-nav .fa{line-height:40px}@media screen and (max-width:559px){#search-form-wrap{display:none}}#search-form-wrap .search-form{position:relative}#search-form-wrap .search-form .search-form-input{width:100%;padding:0 30px 0 15px;line-height:40px;height:40px!important;border-radius:21px}#search-form-wrap .search-form .search-form-input::-webkit-search-cancel-button,#search-form-wrap .search-form .search-form-input::-webkit-search-results-decoration,.search-form-input.ins-search-input::-webkit-search-cancel-button,.search-form-input.ins-search-input::-webkit-search-results-decoration,.search-form-input.st-default-search-input::-webkit-search-cancel-button,.search-form-input.st-default-search-input::-webkit-search-results-decoration,.search-form-input.st-ui-search-input::-webkit-search-cancel-button,.search-form-input.st-ui-search-input::-webkit-search-results-decoration,.search-form-input::-webkit-search-cancel-button,.search-form-input::-webkit-search-results-decoration{-webkit-appearance:none}#search-form-wrap .search-form .search-form-submit{top:50%;right:15px;border:0;cursor:pointer;margin-top:-7px;background:0 0;position:absolute;font:13px font-icon;font-family:FontAwesome}#search-form-wrap .search-form .search-form-submit:before{content:'\f002'}#search-form-wrap .search-form .search-form-submit:focus,#search-form-wrap .search-form .search-form-submit:hover{color:#777}.search-form-input,.search-form-input.ins-search-input,.search-form-input.st-default-search-input,.search-form-input.st-ui-search-input{-webkit-appearance:textarea;-moz-appearance:textarea;appearance:textarea;padding:0;width:200px;box-shadow:none;color:#565a5f;transition:.2s ease;box-sizing:border-box;height:auto!important;line-height:1.6em;outline:0!important;background:0 0!important;font:14px "open sans","Helvetica Neue","Microsoft Yahei",Helvetica,Arial,sans-serif;border:1px solid #eceff2!important}.search-form-input.ins-search-input:focus,.search-form-input.st-default-search-input:focus,.search-form-input.st-ui-search-input:focus,.search-form-input:focus{border-color:#38b7ea!important}#main-nav-mobile{overflow-y:hidden;overflow-x:auto}#main-nav-mobile .menu{margin:0;height:48px}#main-nav-mobile .menu .search-form-input{display:none;padding:0 10px;margin-right:15px;height:32px;line-height:32px;border-radius:16px}@media screen and (max-width:559px){#main-nav-mobile .menu .search-form-input{display:block}}#main-nav-mobile .menu .search-form-input::-webkit-search-cancel-button,#main-nav-mobile .menu .search-form-input::-webkit-search-results-decoration{-webkit-appearance:none}.bio{text-align:center}#profile .inner .bio h2{font-size:1.3em;font-weight:700;margin-top:15px}#profile .inner .bio p{margin:5px 20px 10px;text-align:justify;max-width:300px;line-height:1.5em}.profile-block{padding:15px 20px;border-bottom:1px solid #eceff2}.profile-block:last-child{border-bottom:none}#profile{float:left;width:21.53846153846154%;margin:0 .769230769230769%;display:none}@media screen and (min-width:1200px){#profile{display:block}}#profile .inner{margin-top:40px;background:#fff}#profile .inner .base-info #avatar{display:block;margin:10px auto 20px;width:128px;height:128px}#profile .inner .base-info #location,#profile .inner .base-info #name,#profile .inner .base-info #title{display:block;text-align:center}#profile .inner .base-info #name{font-size:20px;font-weight:600}#profile .inner .base-info #location{font-size:12px;margin-top:5px;color:#9a9ea3}#profile .inner .base-info #location .fa{margin-right:5px}#profile .inner .base-info #follow{color:#fff;width:150px;height:40px;display:block;font-size:14px;line-height:40px;text-align:center;margin:20px auto 10px;background:#38b7ea;border-radius:20px;transition:.2s ease}#profile .inner .base-info #follow:hover{background:#49c8fb}#profile .inner .article-info{padding:0}#profile .inner .article-info:after,#profile .inner .article-info:before,.article-meta:after,.article-meta:before{content:"";display:table}#profile .inner .article-info:after,.article-meta:after{clear:both}#profile .inner .article-info .article-info-block{width:50%;float:left;padding:20px 15px;text-align:center;box-sizing:border-box;font-size:20px}#profile .inner .article-info .article-info-block span{display:block;font-size:14px;text-transform:uppercase}#profile .inner .article-info .article-info-block:first-child{border-right:1px solid #eceff2}#profile .inner .social-links>table td{text-align:center;font-size:24px}#profile .inner .social-links>table td a{position:relative;transition:.2s ease;color:#898d92}#profile .inner .social-links>table td a:hover,.article-meta a,a.article-title:visited{color:#565a5f}#profile .inner .social-links>table td a.tooltip:hover:after{right:-50%;top:-41px;color:#fff;background:#333;font-size:14px;content:attr(title);display:block;padding:5px 15px;position:absolute;white-space:nowrap;border-radius:2px;text-transform:uppercase;box-shadow:0 0 2px rgba(0,0,0,.2);z-index:1}#profile .inner .social-links>table td a.tooltip:hover:before{top:-12px;right:8px;border:solid;border-color:#333 transparent;border-width:5px 5px 0;content:"";display:block;position:absolute;z-index:2}#profile.card{top:50px;right:20px;z-index:999;display:block;min-width:280px;position:absolute}#profile.card .profile-inner{position:relative;box-shadow:0 2px 5px rgba(0,0,0,.2)}#profile.card .profile-inner:after,#profile.card .profile-inner:before{content:'';top:-20px;right:10px;position:absolute;border-width:10px;border-style:solid}#profile.card .profile-inner:before{z-index:1;border-color:transparent transparent #fff}#profile.card .profile-inner:after{z-index:0;border-color:transparent transparent #dbdee1}.article{margin:40px 0}.article-inner{overflow:hidden}.article-banner{width:100%;height:auto}.article-header{padding:20px 20px 0}.article-header .article-title{display:block;margin-bottom:14px}.article-title{font-size:2em;color:#565a5f;text-decoration:none;line-height:1.3em}#comments a,.article-meta a:hover,a.article-title:hover{color:#38b7ea}@media screen and (max-width:559px){.article-title{font-size:1.6em}}@media screen and (min-width:560px) and (max-width:799px){.article-title{font-size:1.6em}}.article-entry,.article-entry p,.article-meta{line-height:1.6em}.article-meta>div{float:left;margin-right:10px}.article-meta>div .fa{margin-right:3px}.article-category .fa-angle-right{margin:0 5px}.article-tag .tag-link:before{content:"#"}.article-entry{color:#565a5f;padding:0 20px}.article-entry:after,.article-entry:before{content:"";display:table}.article-entry:after{clear:both}.article-entry p{text-align:justify;margin:1.6em 0}.article-entry table{line-height:1.6em;margin:1.6em 0;width:100%;border-collapse:collapse;border-spacing:0}.article-entry h1,.article-entry h2,.article-entry h3,.article-entry h4,.article-entry h5,.article-entry h6{line-height:1.3em;margin:1.3em 0}.article-entry a{color:#38b7ea;text-decoration:none}.article-entry a:hover{text-decoration:underline}.article-entry dl,.article-entry ol,.article-entry ul{margin-top:1.6em;margin-bottom:1.6em}.article-entry img,.article-entry video{max-width:100%;height:auto;display:block;margin:auto}.article-entry th{font-weight:700;border-bottom:3px solid #eceff2;padding-bottom:.5em}.article-entry td{border-bottom:1px solid #eceff2;padding:10px 0}.article-entry blockquote{position:static;font-family:Georgia,"Times New Roman","Microsoft Yahei",serif;font-size:1.1em;margin:0 -20px;padding:10px 20px 10px 54px;background:#fcfcfc;border-left:4px solid #eee}.article-entry blockquote:before{top:20px;left:10px;content:"\f10d";color:#e2e2e2;font-size:32px;font-family:FontAwesome;text-align:center;position:static}.article-entry blockquote footer{font-size:14px;margin:1.6em 0;font-family:"open sans","Helvetica Neue","Microsoft Yahei",Helvetica,Arial,sans-serif}.article-entry blockquote footer cite:before{content:"—";padding:0 .5em}.article-entry .pullquote{text-align:left;width:45%;margin:0}.article-entry .pullquote.left{margin-left:.5em;margin-right:1em}.article-entry .pullquote.right{margin-right:.5em;margin-left:1em}.article-entry .caption{color:#999;display:block;font-size:.9em;margin-top:.5em;position:relative;text-align:center}.article-entry .video-container{position:relative;padding-top:56.25%;height:0;overflow:hidden}.article-entry .video-container embed,.article-entry .video-container iframe,.article-entry .video-container object{position:absolute;top:0;left:0;width:100%;height:100%;margin-top:0}.article-more-link a{display:inline-block;line-height:1em;padding:6px 15px;border-radius:15px;background:#f5f8f9;text-shadow:0 1px #fff}.article-more-link a:hover{background:#38b7ea;color:#fff;text-decoration:none;text-shadow:0 1px #169cd2}.article-footer{font-size:.85em;line-height:1.6em;border-top:1px solid #eceff2;padding-top:1.6em;margin:0 20px 20px}#article-nav:after,#article-nav:before,.article-footer:after,.article-footer:before{content:"";display:table}#article-nav:after,.article-footer:after{clear:both}.article-footer a,.article-more-link a{color:#999;text-decoration:none}.article-footer a:hover{color:#565a5f}.article-comment-link,.share-container{float:right}.article-comment-link:before{content:"\f075";font-family:FontAwesome;padding-right:5px}.article-share-link{float:right;cursor:pointer;margin-left:20px}.article-share-link .fa-share,.tagcloud a{margin-right:5px}#article-nav{position:relative}@media screen and (min-width:1200px){#article-nav{margin:40px 0}#article-nav:before{width:8px;height:8px;position:absolute;top:50%;left:50%;margin-top:-4px;margin-left:-4px;content:"";border-radius:50%;background:#787c81}}.article-nav-link-wrap{text-decoration:none;color:#999;box-sizing:border-box;margin-top:40px;text-align:center;display:block}.article-nav-link-wrap:hover{color:#565a5f}@media screen and (min-width:1200px){.article-nav-link-wrap{width:50%;margin-top:0}#article-nav-newer{float:left;text-align:right;padding-right:20px}#article-nav-older{float:right;text-align:left;padding-left:20px}}.article-nav-caption{letter-spacing:2px;line-height:1em;font-weight:700;color:#565a5f;text-transform:uppercase}#article-nav-newer .article-nav-caption{margin-right:-2px}.article-nav-title{font-size:.85em;margin-top:.5em;color:#565a5f;line-height:1.6em}.article-share-box{position:absolute;display:none;background:#fff;box-shadow:0 2px 2px rgba(0,0,0,.1);border-radius:3px;margin-left:-145px;overflow:hidden;z-index:1}.article-share-box.on{display:block}.article-share-input{width:100%;background:0 0;box-sizing:border-box;font:14px "open sans","Helvetica Neue","Microsoft Yahei",Helvetica,Arial,sans-serif;padding:0 10px;color:#565a5f;outline:0;border:1px solid #eceff2;border-radius:3px 3px 0 0;height:36px;line-height:36px}.article-share-links{background:#f5f8f9}.article-share-links:after,.article-share-links:before{content:"";display:table}.article-share-links:after{clear:both}.article-share-facebook,.article-share-google,.article-share-pinterest,.article-share-twitter{width:50px;height:36px;display:block;float:left;position:relative;color:#999;text-shadow:0 1px #fff}.article-share-facebook:before,.article-share-google:before,.article-share-pinterest:before,.article-share-twitter:before{font-size:20px;width:20px;height:20px;position:absolute;top:50%;left:50%;margin-top:-10px;margin-left:-10px;text-align:center}.article-share-facebook:hover,.article-share-google:hover,.article-share-pinterest:hover,.article-share-twitter:hover{color:#fff}.article-share-twitter:hover{background:#00aced;text-shadow:0 1px #008abe}.article-share-facebook:hover{background:#3b5998;text-shadow:0 1px #2f477a}.article-share-pinterest:hover{background:#cb2027;text-shadow:0 1px #a21a1f}.article-share-google:hover{background:#dd4b39;text-shadow:0 1px #be3221}.toc-article{background:#f9f9f9;margin:2em 0 0 .2em;padding:1em;border-radius:0}.toc-article .toc-title{font-size:120%}.toc-article strong{padding:.3em 1}ol.toc{width:100%;margin:1em 2em 0 0}#toc{line-height:1em;font-size:.8em;float:right}#toc .toc{padding:0}#toc .toc li{list-style-type:none}#toc .toc-child{padding-left:0}#toc.toc-aside{display:none;width:13%;position:fixed;right:2%;top:320px;overflow:hidden;line-height:1.5em;font-size:1em;color:color-heading;opacity:.6;transition:opacity 1s ease-out}#toc.toc-aside strong{padding:.3em 0;color:color-font}#toc.toc-aside:hover{transition:opacity .3s ease-out;opacity:1}#toc.toc-aside a{transition:color 1s ease-out}#toc.toc-aside a:hover{color:color-theme;transition:color .3s ease-out}.article.rtl .article-entry p,.article.rtl .article-title{direction:rtl}.article.rtl .article-meta>div{float:right;margin-left:10px;margin-right:0}#comments{padding:20px;background-color:transparent;margin:40px 0}.archives:after,.archives:before{content:"";display:table}.archives:after{clear:both}.archives .article:first-child{margin:20px 0}.archive-category-wrap,.archive-tag-wrap,.archive-year-wrap,.layout-title{font-size:1.4em;margin:40px 0 20px}@media screen and (max-width:559px){.archive-category-wrap,.archive-tag-wrap,.archive-year-wrap,.layout-title{padding:0 15px;font-size:1.2em}}.archive-category-wrap .fa,.archive-tag-wrap .fa,.archive-year-wrap .fa,.layout-title .fa{margin-right:3px}.archive-category-wrap .archive-year,.archive-tag-wrap .archive-year,.archive-year-wrap .archive-year,.layout-title .archive-year{color:#565a5f}#recent-post li .item-inner .item-category a,#recent-post li .item-inner a a,.archive-category-wrap .archive-year:hover,.archive-tag-wrap .archive-year:hover,.archive-year-wrap .archive-year:hover,.layout-title .archive-year:hover{color:#38b7ea}@media screen and (max-width:559px){.layout-wrap-inner{padding:0 15px}}.archive-article{page-break-inside:avoid;overflow:hidden;-moz-column-break-inside:avoid;break-inside:avoid-column;padding:0;margin-bottom:15px}#page-nav:after,#page-nav:before,.archive-article:after,.archive-article:before{content:"";display:table}#page-nav:after,.archive-article:after{clear:both}.archive-article.archive-type-summary{padding:15px}.archive-article.archive-type-summary .article-entry{padding:0}.archive-article.archive-type-summary .article-entry p{margin:12px 0}.archive-article .archive-article-content,.archive-article .archive-article-thumbnail{display:table-cell;vertical-align:top}@media screen and (max-width:559px){.archive-article .archive-article-content,.archive-article .archive-article-thumbnail{display:block}}.archive-article .archive-article-thumbnail{width:160px;padding-right:15px}@media screen and (max-width:559px){.archive-article .archive-article-thumbnail{width:100%;padding-bottom:15px}}.archive-article .archive-article-thumbnail .thumbnail{height:0;width:100%;padding-bottom:56.25%;display:block;position:relative;overflow:hidden}#recent-post li .item-thumbnail .thumbnail span,.archive-article .archive-article-thumbnail .thumbnail span{width:100%;height:100%;display:block}#recent-post li .item-thumbnail .thumbnail .thumbnail-image,.archive-article .archive-article-thumbnail .thumbnail .thumbnail-image{position:absolute;background-size:cover;background-position:center}.archive-article .archive-article-thumbnail .thumbnail .thumbnail-none{background-image:url(images/thumb-default-small.png)}.archive-article-title{display:block;font-size:1.6em;line-height:1.4em;margin-bottom:12px}@media screen and (max-width:559px){.archive-article-title{display:block;font-size:1.3em}}.archive-article-date{display:block;margin-top:8px}.layout-wrap-inner.list-categories ul{margin-left:15px;list-style:none}.layout-wrap-inner.list-categories ul .category-list-child,.layout-wrap-inner.list-categories ul li{padding:10px 0;font-size:14px;border-bottom:1px solid border-color}.layout-wrap-inner.list-categories ul .category-list-child a,.layout-wrap-inner.list-categories ul li a{color:#777}.layout-wrap-inner.list-categories ul ol li:last-child,.layout-wrap-inner.list-categories ul ul li:last-child,.widget ol ol li:last-child,.widget ol ul li:last-child,.widget ul ol li:last-child,.widget ul ul li:last-child{padding-bottom:0}.layout-wrap-inner.list-categories li a:before{color:#ccc;content:"\f0da";font-size:12px;margin-right:6px;font-family:FontAwesome;transition:.2s ease}.ins-section .ins-search-item header .fa,.layout-wrap-inner.tag-cloud a{margin-right:8px}.layout-wrap-inner.tag-cloud a:before{content:'#'}#page-nav{margin:40px auto;text-align:center;color:#999;overflow:hidden}#page-nav a,#page-nav span{height:32px;padding:0 10px;line-height:32px;text-align:center;display:inline-block;border-radius:2px}#page-nav a{color:#999;text-decoration:none}#page-nav a:hover{color:#fff;background:#38b7ea}#page-nav .page-number{display:inline-block}@media screen and (max-width:559px){#page-nav .page-number{display:none}}#page-nav .current{color:#565a5f;font-weight:700}.timeline-wrap{margin:40px 20px 40px 40px;border-left:3px solid #eceff2}@media screen and (max-width:559px){.timeline-wrap{margin:40px 20px 40px 30px}}@media screen and (min-width:560px) and (max-width:799px){.timeline-wrap{margin:40px 20px 40px 30px}}.timeline-row{margin:20px 0}#recent-post li:after,#recent-post li:before,.timeline-row:after,.timeline-row:before{content:"";display:table}#recent-post li:after,.timeline-row:after{clear:both}.timeline-row .node,.timeline-row .title{float:left}.timeline-row .node{width:12px;color:#fff;height:12px;border-radius:50%;margin:11px 0 0 -8px;display:inline-block;background-color:#38b7ea}.timeline-row .content{margin-left:25px;position:relative}.timeline-row .content:after,.timeline-row .content:before{content:'';position:absolute;display:inline-block}.timeline-row .content:after{top:10px;left:-14px;border:7px solid transparent;border-right-color:#fff}.timeline-row .content:before{top:9px;left:-16px;border:8px solid transparent;border-right-color:rgba(0,0,0,.05)}.timeline-row .content .article-meta,.timeline-row .content h1{padding:10px}#footer,.timeline-row .content h1{font-size:16px}.timeline-row .content .article-meta{font-size:12px;color:#898d92;border-top:1px solid #f7f7f7;background-color:rgba(244,246,247,.2)}.timeline-row-major .node{width:14px;height:14px;font-size:14px;margin:0 0 0 -17px;padding:6px 8px 10px}.timeline-row-major .title{font-size:18px;margin-left:15px;line-height:30px}#footer{padding:20px 0;border-top:1px solid #eceff2;color:#565a5f;text-align:center}#footer .outer{margin-bottom:0}#footer a{color:#38b7ea}#footer a:hover{text-decoration:underline}#footer-info,.widget{line-height:1.6em;font-size:.85em}@media screen and (min-width:1200px){#sidebar{display:inline;float:left;width:21.53846153846154%;margin:0 .769230769230769%}}@media screen and (min-width:800px) and (max-width:1199px){#sidebar{display:inline;float:left;width:29.230769230769234%;margin:0 .769230769230769%}}.widget{word-wrap:break-word;font-size:.9em}.widget ol,.widget ul{margin:0;list-style:none}.widget ol ol,.widget ol ul,.widget ul ol,.widget ul ul{margin:0 20px}.archive-list-count,.category-list-count,.tag-list-count{padding-left:5px;color:#999;font-size:.85em}.archive-list-count:before,.category-list-count:before,.tag-list-count:before{content:"("}.archive-list-count:after,.category-list-count:after,.tag-list-count:after{content:")"}.widget-wrap{margin:40px 10px}@media screen and (max-width:559px){.widget-wrap{margin:40px 20px}}.widget-title{margin-bottom:0}.widget{padding:15px 5px}#footer a,.widget a{text-decoration:none}#recent-post li .item-inner .item-category a:hover,#recent-post li .item-inner a a:hover,.layout-wrap-inner.list-categories li a:hover:before,.widget a:hover{color:#333}.widget dl dl,.widget dl ol,.widget dl ul,.widget ol dl,.widget ul dl{margin-left:15px;list-style:disc}.widget ol ol,.widget ol ul,.widget ul ol,.widget ul ul{margin-left:15px;list-style:none}.widget ol .category-list-child,.widget ol li,.widget ul .category-list-child,.widget ul li{padding:10px 0;font-size:14px;border-bottom:1px solid border-color}.widget a,.widget ol .category-list-child a,.widget ol li a,.widget ul .category-list-child a,.widget ul li a{color:#777}.widget ol:not(#recent-post) li a:before,.widget ul:not(#recent-post) li a:before{color:#ccc;content:"\f0da";font-size:12px;margin-right:6px;font-family:FontAwesome;transition:.2s ease}.widget ol:not(#recent-post) li a:hover:before,.widget ul:not(#recent-post) li a:hover:before{color:#333}#toTop{cursor:pointer;text-align:center;width:60px;height:60px;font-size:50px;line-height:55px;background:#565a5f;opacity:.8;border-radius:4px;bottom:20px;position:fixed}@media screen and (min-width:560px) and (max-width:799px){#toTop{width:52px;height:52px;font-size:34px;line-height:52px}}@media screen and (max-width:559px){#toTop{width:48px;height:48px;font-size:32px;line-height:48px}}#recent-post li{padding:10px 0 10px 94px}#recent-post.no-thumbnail li{padding:10px 0}#recent-post li .item-thumbnail{opacity:1;float:left;margin-left:-94px;transition:all .2s ease}#recent-post li .item-thumbnail .thumbnail{width:80px;height:80px;display:block;position:relative;overflow:hidden}#recent-post li .item-thumbnail .thumbnail .thumbnail-none{background-image:url(images/thumb-default-small.png);background-size:100% 100%}#recent-post li .item-inner .item-category,#recent-post li .item-inner a{font-size:13px;text-transform:uppercase}#recent-post li .item-inner .item-category .fa,#recent-post li .item-inner .item-category a,#recent-post li .item-inner a .fa,#recent-post li .item-inner a a{margin-right:5px}#recent-post li .item-inner .item-title{font-size:15px}#recent-post li .item-inner .item-title a{color:#333;transition:all .2s ease}#recent-post li .item-inner .item-date{color:#aaa;font-size:13px;text-transform:uppercase}#recent-post li:hover .item-thumbnail{opacity:.8}#recent-post li:hover .item-title a{color:#38b7ea}#toTop,.ins-search{display:none}.ins-search.show{display:block}.ins-selectable{cursor:pointer}.ins-search-container,.ins-search-mask{position:fixed}.ins-search-mask{top:0;left:0;width:100%;height:100%;z-index:100;background:rgba(0,0,0,.5)}.ins-input-wrapper{position:relative}.ins-search-input{width:100%;border:0;outline:0;font-size:16px;box-shadow:none;font-weight:200;border-radius:0;background:#fff;line-height:20px;box-sizing:border-box;padding:12px 28px 12px 20px;border-bottom:1px solid #e2e2e2;font-family:"Microsoft Yahei Light","Microsoft Yahei",Helvetica,Arial,sans-serif}.ins-close{top:50%;right:6px;width:20px;height:20px;font-size:16px;margin-top:-11px;position:absolute;text-align:center;display:inline-block}.ins-close:hover{color:#006bde}.ins-search-container{left:50%;top:100px;z-index:101;bottom:100px;box-sizing:border-box;width:540px;margin-left:-270px}@media screen and (max-width:559px),screen and (max-height:479px){.ins-search-container{top:0;left:0;margin:0;width:100%;height:100%;background:#f7f7f7}}.ins-section-wrapper{left:0;right:0;top:45px;bottom:0;overflow-y:auto;position:absolute}.ins-section-container{position:relative;background:#f7f7f7}.ins-section{font-size:14px;line-height:16px}.ins-section .ins-search-item,.ins-section .ins-section-header{padding:8px 15px}.ins-section .ins-section-header{color:#9a9a9a;border-bottom:1px solid #e2e2e2}.ins-section .ins-slug{margin-left:5px;color:#9a9a9a}.ins-section .ins-slug:before{content:'('}.ins-section .ins-slug:after{content:')'}.ins-section .ins-search-item .ins-search-preview,.ins-section .ins-search-item header{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.ins-section .ins-search-item .ins-search-preview{height:15px;font-size:12px;color:#9a9a9a;margin:5px 0 0 20px}.ins-section .ins-search-item.active,.ins-section .ins-search-item:hover{color:#fff;background:#006bde}#toTop,.ins-section .ins-search-item.active .ins-search-preview,.ins-section .ins-search-item.active .ins-slug,.ins-section .ins-search-item:hover .ins-search-preview,.ins-section .ins-search-item:hover .ins-slug{color:#fff}</style><link href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css" rel="stylesheet"><meta content="Hexo 5.2.0" name="generator"></head><body><div id="container"><header id="header"><div class="header-inner" id="header-main"><div class="outer"> <a href="/" id="logo"><span class="site-title">oded.dev</span></a><nav id="main-nav"></nav><nav id="sub-nav"><div class="profile" id="profile-nav"> <a href="javascript:;" id="profile-anchor"><img src="/images/logo.jpg" class="avatar"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form class="search-form"> <input class="ins-search-input search-form-input" placeholder="Search"> <button class="search-form-submit" type="submit"></button></form></div></div></div><div class="header-inner header-sub" id="main-nav-mobile"><table class="outer menu"><tr><td><div class="search-form"> <input class="ins-search-input search-form-input" placeholder="Search"></div></td></tr></table></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="profile-block base-info"> <img src="/images/logo.jpg" id="avatar"><h2 id="name">Oded Lazar</h2><h3 id="title">I code during the day, and think about the bugs I created at night.</h3><span id="location"><i class="fa fa-map-marker"></i> Israel</span> <a href="/about-me" id="follow">ABOUT</a></div><div class="profile-block article-info"><div class="article-info-block"> 100 <span>posts</span></div><div class="article-info-block"> 47 <span>tags</span></div></div><div class="profile-block social-links"><table><tr><td><a href="https://github.com/odedlaz" target="_blank" class="tooltip" title="github"><i class="fa fa-github"></i></a></td><td><a href="https://facebook.com/oded.blog" target="_blank" class="tooltip" title="facebook"><i class="fa fa-facebook"></i></a></td><td><a href="https://linkedin.com/in/odedlaz" target="_blank" class="tooltip" title="linkedin"><i class="fa fa-linkedin"></i></a></td><td><a href="https://oded.dev/atom.xml" target="_blank" class="tooltip" title="rss"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article class="article article-type-post" id="post-SSH-GlobalProtect" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2021/02/22/SSH-GlobalProtect/" class="article-title">Working from Home + Corporate VPN</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2021/02/22/SSH-GlobalProtect/"><time datetime="2021-02-22T17:30:03.000Z" itemprop="datePublished">2021-02-22</time></a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/devops/" rel="tag" class="tag-link-link">devops</a>, <a href="/tags/linux/" rel="tag" class="tag-link-link">linux</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Hey everyone! today I’d like to tell you a small story about a guy that’s been stuck working from home for more than a year and is suffering from constant VPN issues. This guy is me!</p><p>TLDR: can’t access corporate resources? use static routing to redirect connections through the corporate VPN.</p><p>Ok, so the story goes like this: I work at a Big-Corp, really big corp. some people might’ve heard about it: Microsoft. My team has a couple of VMs deployed on Azure which are governed by an internal service that makes sure that nobody can access them outside the corporate VPN. The service thus a bunch more things, but the gist is that one can’t alter the network security group (“firewall” rules) such that outsiders can access the machine.</p><p>That’s pretty neat, but problematic when you work from home. Why? not all network originating from our machine goes through the corporate network. In other words, when I try to access any resource that belongs to my team, the IP that’s being used is the one that belongs to my ISP –&gt; forbidden.</p><p>How do I know that? my laptop’s <a href="https://en.wikipedia.org/wiki/Routing_table" rel="noopener" target="_blank">routing table</a>. The routing table is in charge of mapping the network routes for a given destination IP. On my macOS machine the routing table looks something like this:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ netstat -rn</span><br><span class="line">Routing tables</span><br><span class="line"></span><br><span class="line">Internet:</span><br><span class="line">Destination        Gateway            Flags        Netif Expire</span><br><span class="line">default            10.0.0.1           UGSc         en0</span><br><span class="line">127                127.0.0.1          UCS          lo0       </span><br><span class="line">127.0.0.1          127.0.0.1          UH           lo0       </span><br></pre></td></tr></table></figure><p>I truncated some values, but the gist is: anything that belongs to localhost -&gt; use the <code>lo0</code> interface and everything else go to the default, which is <code>10.0.0.1</code>. If I turn on the VPN, a new virtual network device appears (a.k.a: <a href="https://en.wikipedia.org/wiki/TUN/TAP" rel="noopener" target="_blank">tun device</a>) and many (many!) more routes show up:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ netstat -rn</span><br><span class="line">Routing tables</span><br><span class="line"></span><br><span class="line">Internet:</span><br><span class="line">Destination        Gateway            Flags        Netif Expire</span><br><span class="line">default            10.0.0.1           UGSc         en0</span><br><span class="line">127                127.0.0.1          UCS          lo0       </span><br><span class="line">127.0.0.1          127.0.0.1          UH           lo0       </span><br><span class="line">&lt;corporate-ip-1&gt;   10.10.5.125        UGHS         utun2       </span><br><span class="line">&lt;corporate-ip-2&gt;   10.10.5.125        UGHS         utun2       </span><br><span class="line">...</span><br><span class="line">&lt;corporate-ip-500&gt; 10.10.5.125        UGHS         utun2       </span><br></pre></td></tr></table></figure><p>What basically happens is that the VPN client connects to the vpn server, creates a secure tunnel between my computer and the VPN server, fetches a policy that dictates which IPs and subnets should go through the corporate network and configures my machine to send such traffic through the virtual interface.</p><p>When a packet hits the virtual interface, it gets encrypted and sent over the public internet to the VPN server. The VPN server has two “legs”: one in the corporate network and one in the public network. Once a client connects, every (verified) packet that arrives to the VPN server on the public internet gets sent to the corporate network.</p><p>In our case, we have an azure resource that can only be accessed through the corporate network.<br>we want to access a specific azure resource that is not configured in the VPN policy. There are two solutions: either fix it locally or use a <a href="https://en.wikipedia.org/wiki/Jump_server" rel="noopener" target="_blank">jumpbox</a>.</p><p>A jumpbox is a machine that has access to both networks: the public one and the corporate one. I can connect to it (using ssh, rdp, whatever) and than connect to the remote resource. SSH even has a flag for that (<code>-J</code> or <code>ProxyJump</code>):</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># We connect to the jumpbox than the jumpbox connects to the remote-pc,</span></span><br><span class="line"><span class="comment"># and proxying the traffic between our machine and the remote.</span></span><br><span class="line">$ ssh -J otheruser@jumpbox user@remote-pc</span><br></pre></td></tr></table></figure><p>Hack, why should we need another PC? why not just route traffic to the VPN? should be easy. well, it is, all we need to do is a simple static route:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$  sudo route -n add -net &lt;our-public-ip&gt; &lt;vpn-gateway-ip&gt;</span><br></pre></td></tr></table></figure><p>That’s easy enough, but I honestly don’t want to add a static route everytime I want to connect to a remote resource. ITS A PAIN IN THE ASS! Why not write script to do that for me?</p><p>Well, I need a few things:</p><p>First, I need a way to extract the gateway IP address. the problem? GlobalConnect uses a different IP and with a different interface name everytime it connects!</p><p>Second, I want a robust script that has the same completion as ssh does.</p><p>Let’s tackle the first issue: I guess that GlobalConnect has logs somewhere or a configuration that specifies the interface and ip address it used to create the tun device. in macOS this stuff should sit at <code>/Library</code>. I grepped for the VPN server address and viola!</p><p><code>/Library/Preferences/com.paloaltonetworks.GlobalProtect.settings.plist</code> contains the VPN configuration:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-&#x2F;&#x2F;Apple&#x2F;&#x2F;DTD PLIST 1.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.apple.com&#x2F;DTDs&#x2F;PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version&#x3D;&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">	&lt;key&gt;Palo Alto Networks&lt;&#x2F;key&gt;</span><br><span class="line">	&lt;dict&gt;</span><br><span class="line">		&lt;key&gt;GlobalProtect&lt;&#x2F;key&gt;</span><br><span class="line">		&lt;dict&gt;</span><br><span class="line">			&lt;key&gt;PanGPS&lt;&#x2F;key&gt;</span><br><span class="line">			&lt;dict&gt;</span><br><span class="line">                ... many keys ...</span><br><span class="line">				&lt;key&gt;PreferredIPV6_11de985a54adccec223de2b24075693f&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;2a01:110:8:6:8000::5&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIPV6_234d2be7acce021cd9e49f5c5a7bc41&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;2a01:110:68:41:8000::9&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIPV6_93bb97413136ce437a86418851ac5e99&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;2404:f801:50:a:8000::84&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIPV6_d1ded811e3311a45e766352fca97c7cb&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;2a01:110:20:10:8000::147&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIP_11de985a54adccec223de2b24075693f&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;10.10.1.35&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIP_234d2be7acce021cd9e49f5c5a7bc41&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;10.10.5.125&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIP_93bb97413136ce437a86418851ac5e99&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;10.10.1.38&lt;&#x2F;string&gt;</span><br><span class="line">				&lt;key&gt;PreferredIP_d1ded811e3311a45e766352fca97c7cb&lt;&#x2F;key&gt;</span><br><span class="line">				&lt;string&gt;10.10.1.120&lt;&#x2F;string&gt;</span><br><span class="line">			&lt;&#x2F;dict&gt;</span><br><span class="line">            ... many keys ...</span><br><span class="line">&lt;&#x2F;plist&gt;</span><br></pre></td></tr></table></figure><p>God! this is a piece of shit. I hate parsing xml… maybe there’s something that can parse plist files? YESSSS!!! <code>/usr/libexec/PlistBuddy</code> does just that! it’s like <a href="https://stedolan.github.io/jq/" rel="noopener" target="_blank">jq</a> but for <a href="https://en.wikipedia.org/wiki/Property_list" rel="noopener" target="_blank">plist</a>!</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ GP_CONFIG&#x3D;&#x2F;Library&#x2F;Preferences&#x2F;com.paloaltonetworks.GlobalProtect.settings.plist</span><br><span class="line">$ &#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;print &#39;Palo Alto Networks&#39;:GlobalProtect:PanGPS&quot; &quot;$GP_CONFIG&quot; | \</span><br><span class="line">  awk -F&#39;&#x3D;&#39; &#39;&#x2F;PreferredIP_&#x2F; &#123; print $2 &#125;&#39; | \</span><br><span class="line">  tr -d &#39;[:blank:]&#39; | \</span><br><span class="line">  xargs -I &#123;&#125; fish -c &quot;ifconfig -a | awk &#39;&#x2F;inet &#123;&#125;&#x2F; &#123; print \$2 &#125;&#39;&quot;</span><br></pre></td></tr></table></figure><p>Turns out there’s another way. I also grepped the vpn gateway IP and found it at <code>/Library/Logs/PaloAltoNetworks/GlobalProtect/network/config/itf-install.sh</code>.</p><p>GlobalConnect writes down all the configuration to the logs directory, including the scripts it uses to configure the routes. the <code>itf-install.sh</code> contains this:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/sbin/ifconfig utun2 10.10.5.125 10.10.5.125 netmask 255.255.255.255 up</span><br><span class="line">/sbin/ifconfig utun2 inet6 2a01:110:68:41:8000::9/128 up</span><br></pre></td></tr></table></figure><p>Awesome! I can just awk it, but I do need root permissions :(</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ITF_INSTALL&#x3D;&#x2F;Library&#x2F;Logs&#x2F;PaloAltoNetworks&#x2F;GlobalProtect&#x2F;network&#x2F;config&#x2F;itf-install.sh</span><br><span class="line">$ sudo awk &#39;&#x2F;\&#x2F;sbin\&#x2F;ifconfig [^ ]+ [0-9]&#x2F; &#123; print $3 &#125;&#39; &quot;$ITF_INSTALL&quot;</span><br></pre></td></tr></table></figure><p>Anyway, once that’s working, what about completion? well, in <a href="https://fishshell.com/" rel="noopener" target="_blank">fish shell</a> this is pretty straight forward. All I had to do is find the completion file for <code>ssh</code> and just copy it for my script. I called my script <code>vssh</code> and the <code>ssh</code> completion file sat here: <code>/opt/local/share/fish/completions/ssh.fish</code>. I copied it to <code>~/.config/fish/completions</code>, replaced <code>ssh</code> with <code>vssh</code> and viola! I had tab completions :)</p><p>Let’s start writing down our script… the skeleton should look like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env fish</span><br><span class="line"></span><br><span class="line">set remote &lt;remote-pc&gt;</span><br><span class="line"></span><br><span class="line"># get the ip address of the vpn device, using the first method</span><br><span class="line">set gateway (get_global_protect_interface_ipaddr_from_config)</span><br><span class="line"></span><br><span class="line"># if first method failed, try the second method</span><br><span class="line">if test -z &quot;$gateway&quot;</span><br><span class="line">   echo &quot;need root privileges in order to find the vpn gateway&quot;</span><br><span class="line">   set gateway (get_global_protect_interface_ipaddr_from_install_script)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># test that we have a gateway</span><br><span class="line">if ! ifconfig -a | grep &quot;$gateway&quot; &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">    echo &quot;couldn&#39;t find any interface bound to $gateway&quot;</span><br><span class="line">    echo &quot;maybe the vpn client is not connected?&quot;</span><br><span class="line">    exit 1</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">if &lt;remote-pc-default-gateway&gt; !&#x3D; &lt;vpn-gateway&gt;</span><br><span class="line">   add_static_route &lt;remote-pc&gt; &lt;vpn-gateway&gt; || exit 1</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">ssh $argv</span><br></pre></td></tr></table></figure><p>this is pretty straight forward, but two things are missing: how do I find out the hostname if I’m passing arbitrary ssh args? and second, how will this work with ssh-config?</p><p><code>ssh -G</code> to the rescue! the <code>-G</code> flag causes ssh to print its configuration after evaluating Host and Match blocks. I can use it to find out the actual hostname that <code>ssh</code> is going to use in order to connect to the remote host!</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set remote (ssh -G $argv 2&gt;&#x2F;dev&#x2F;null | awk &#39;&#x2F;^hostname&#x2F; &#123; print $2 &#125;&#39;)</span><br></pre></td></tr></table></figure><p>cool, right?! That’s all folks! I’ve uploaded the whole script <a href="https://gist.github.com/odedlaz/d7ab932bb6c26912bfa64de32d0cfb53" rel="noopener" target="_blank">to my GitHub</a>. as always, feel free to comment :)</p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="Working from Home + Corporate VPN" data-a2a-url="https://oded.dev/2021/02/22/SSH-GlobalProtect/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-AX3600-1" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2020/11/30/AX3600-1/" class="article-title">AX3600 - Post #1</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2020/11/30/AX3600-1/"><time datetime="2020-11-30T19:08:00.000Z" itemprop="datePublished">2020-11-30</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/hacking/" class="article-category-link">hacking</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/ax3600/" rel="tag" class="tag-link-link">ax3600</a>, <a href="/tags/linux/" rel="tag" class="tag-link-link">linux</a>, <a href="/tags/xiaomi/" rel="tag" class="tag-link-link">xiaomi</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>In my <a href="/2020/10/23/AX3600-0">previous post</a> I gave you an intro about AX3600 and how awesome it is. This post will focus on how to gain persistent ssh on the device.</p><p>First off, I recommend following the OpenWRT effort on porting AX3600: <a href="https://forum.openwrt.org/t/adding-openwrt-support-for-xiaomi-ax3600/55049" rel="noopener" target="_blank">Adding OpenWrt support for Xiaomi AX3600 For Developers</a>. Until then, follow this guide.</p><p>All the scripts, firmwares, configuration files, etc’ mentioned in this post are available on GitHub: <a href="https://github.com/odedlaz/ax3600-files" rel="noopener" target="_blank">odedlaz/ax3600-files</a>. Please feel free to open issues or better yet - pull requests!!</p><h1 id="gain-SSH-access"><a href="#gain-SSH-access" class="headerlink" title="gain SSH access"></a>gain SSH access</h1><p>All you need to know is that early versions of the router had a command injection vulnerability that is now closed. In order to gain ssh access, you first need to downgrade your router’s firmware then run the commands listed in <a href="https://openwrt.org/inbox/toh/xiaomi/xiaomi_ax3600" rel="noopener" target="_blank">OpenWRT’s page</a>. But what is the command injection? taking closer look at the source…</p><p>We want to extract the firmware. Thankfully, there’s a tool just for that: <a href="https://github.com/jrspruitt/ubi_reader" rel="noopener" target="_blank">ubi_reader</a>.<br>Follow the instruction and get it up and running. Once you do, <a href="http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/r3600/miwifi_r3600_firmware_5da25_1.0.17.bin" rel="noopener" target="_blank">download the firmware</a> and run:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ubireader_extract_images -o xioamifw -w miwifi_r3600_firmware_5da25_1.0.17.bin</span><br><span class="line">$ unsquashfs -f -d xiaomifw xioamifw/miwifi_r3600_firmware_5da25_1.0.17.bin/img-1696626347_vol-ubi_rootfs.ubifs</span><br></pre></td></tr></table></figure><p>The command injection URL looks like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.31.1&#x2F;cgi-bin&#x2F;luci&#x2F;;stok&#x3D;&lt;STOK&gt;&#x2F;api&#x2F;misystem&#x2F;set_config_iotdev?bssid&#x3D;gallifrey&amp;user_id&#x3D;doctor&amp;ssid&#x3D;-h%0Anvram%20set%20ssh%5Fen%3D1%0A</span><br></pre></td></tr></table></figure><p>How does it work? let’s find <code>set_config_iotdev</code>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ grep! -R <span class="string">&quot;set_config_iotdev&quot;</span></span><br><span class="line">xioamifw/miwifi_r3600_firmware_5da25_1.0.17.bin/output/usr/lib64/lua/luci/controller/api/misystem.lua:    entry(&#123;<span class="string">&quot;api&quot;</span>, <span class="string">&quot;misystem&quot;</span>, <span class="string">&quot;set_config_iotdev&quot;</span>&#125;,           call(<span class="string">&quot;setConfigIotDev&quot;</span>), (<span class="string">&quot;&quot;</span>), 221)</span><br></pre></td></tr></table></figure><p>Ok, it looks like there’s a file called <code>misystem.lua</code> that contains all the controller apis. Also, the <code>set_config_iotdev</code> parameter is tied to the <code>setConfigIotDev</code>. easy enough… let’s look at it:</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setConfigIotDev</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> XQFunction = <span class="built_in">require</span>(<span class="string">&quot;xiaoqiang.common.XQFunction&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> LuciUtil = <span class="built_in">require</span>(<span class="string">&quot;luci.util&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> result = &#123;</span><br><span class="line">        [<span class="string">&quot;code&quot;</span>] = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> ssid = LuciHttp.formvalue(<span class="string">&quot;ssid&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> bssid = LuciHttp.formvalue(<span class="string">&quot;bssid&quot;</span>)</span><br><span class="line">    <span class="keyword">local</span> uid = LuciHttp.formvalue(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line"></span><br><span class="line">    XQLog.<span class="built_in">log</span>(debug_level, <span class="string">&quot;ssid = &quot;</span>..ssid)</span><br><span class="line">    XQLog.<span class="built_in">log</span>(debug_level, <span class="string">&quot;bssid = &quot;</span>..bssid)</span><br><span class="line">    XQLog.<span class="built_in">log</span>(debug_level, <span class="string">&quot;uid = &quot;</span>..uid)</span><br><span class="line">    <span class="keyword">if</span> XQFunction.isStrNil(ssid) </span><br><span class="line">        <span class="keyword">or</span> XQFunction.isStrNil(bssid) </span><br><span class="line">        <span class="keyword">or</span> XQFunction.isStrNil(uid) <span class="keyword">then</span></span><br><span class="line">        result.code = <span class="number">1523</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> result.code ~= <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        result[<span class="string">&quot;msg&quot;</span>] = XQErrorUtil.getErrorMessage(result.code)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        XQFunction.forkExec(<span class="string">&quot;connect -s &quot;</span>..ssid..<span class="string">&quot; -b &quot;</span>..bssid.. <span class="string">&quot; -u &quot;</span>..uid)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    LuciHttp.write_json(result)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Very straight forward and classic! look at the line starting with <code>forkExec</code>: there’s no input validation, thus parameters supplied to the api are used on the router itself and passed directly to exec. The injection basically add a <code>\n</code> to the end of the last parameter, following by the command we really want to run, which is <code>nvram set ssh_en=1</code>.</p><p>By the way, on later firmwares the <code>misystem.lua</code> is compiled and encrypted. While trying to figure out how to decrypt it I came across a great deck called <a href="https://hitcon.org/2020/slides/Exploit%20(Almost)%20All%20Xiaomi%20Routers%20Using%20Logical%20Bugs.pdf" rel="noopener" target="_blank">Exploit (Almost) all Xiaomi Routers Using Logical Bugs</a> which you might like.</p><p>Enough! we just want to gain SSH! Let’s downgrade. It’s pretty easy, all you need to do is:</p><ol><li>access the setting page: <code>http://192.168.31.1/cgi-bin/luci/;stok=&lt;STOK&gt;/web/setting/upgrade</code></li><li>press “Manual upgrade” (I’ve got Google Translate turned on)</li><li>upload the firmware (miwifi_r3600_firmware_5da25_1.0.17.bin). I <a href="https://github.com/odedlaz/ax3600-files/raw/master/firmwares/miwifi_r3600_firmware_5da25_1.0.17.bin" rel="noopener" target="_blank">backed it up</a> since I’m a bit paranoid. You can find it under the firmwares directory in my repo or the <a href="http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/r3600/miwifi_r3600_firmware_5da25_1.0.17.bin" rel="noopener" target="_blank">official link</a>.</li></ol><p>Afterwards, you can follow the guide supplied by OpenWRT or just import the <a href="https://github.com/odedlaz/ax3600-files/blob/master/scripts/AX3600.postman_collection.json" rel="noopener" target="_blank">Postman collection I created</a>. Don’t forget to update the <code>stok</code> variable in the collection. You can grab it by logging in to the router web interface and getting the value of “stok=” from the URL.</p><h1 id="gain-persistent-SSH"><a href="#gain-persistent-SSH" class="headerlink" title="gain persistent SSH"></a>gain persistent SSH</h1><p>A guy called didiaoing <a href="https://www.wutaijie.cn/?p=254" rel="noopener" target="_blank">wrote a nice tutorial</a> which explains how to modify the routers bdata partition in order to persistenly turn on ssh. The problem? it’s manual, error prone and in chinese.</p><p>Enough talkin’! let’s get flashin’!</p><p>Clone my repo and create a bdata directory:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/odedlaz/ax3600-files.git</span><br><span class="line">$ <span class="built_in">cd</span> ax3600-files</span><br><span class="line">$ mkdir -p bdata</span><br></pre></td></tr></table></figure><p>The router’s uses <a href="https://en.wikipedia.org/wiki/UBIFS" rel="noopener" target="_blank">UBIFS</a> as it’s filesystem. UBIFS workes on top of <a href="https://en.wikipedia.org/wiki/UBIFS#UBI" rel="noopener" target="_blank">UBI</a>, which in turn works on top of <a href="https://en.wikipedia.org/wiki/Memory_Technology_Device" rel="noopener" target="_blank">MTD</a>.</p><p>You can ssh to your router and see the mtd partitions for yourself, they’re all there for the taking:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat /proc/mtd</span><br><span class="line">dev:    size   erasesize  name</span><br><span class="line">mtd0: 00100000 00020000 <span class="string">&quot;0:SBL1&quot;</span></span><br><span class="line">mtd1: 00100000 00020000 <span class="string">&quot;0:MIBIB&quot;</span></span><br><span class="line">mtd2: 00300000 00020000 <span class="string">&quot;0:QSEE&quot;</span></span><br><span class="line">mtd3: 00080000 00020000 <span class="string">&quot;0:DEVCFG&quot;</span></span><br><span class="line">mtd4: 00080000 00020000 <span class="string">&quot;0:RPM&quot;</span></span><br><span class="line">mtd5: 00080000 00020000 <span class="string">&quot;0:CDT&quot;</span></span><br><span class="line">mtd6: 00080000 00020000 <span class="string">&quot;0:APPSBLENV&quot;</span></span><br><span class="line">mtd7: 00100000 00020000 <span class="string">&quot;0:APPSBL&quot;</span></span><br><span class="line">mtd8: 00080000 00020000 <span class="string">&quot;0:ART&quot;</span></span><br><span class="line">mtd9: 00080000 00020000 <span class="string">&quot;bdata&quot;</span></span><br><span class="line">mtd10: 00080000 00020000 <span class="string">&quot;crash&quot;</span></span><br><span class="line">mtd11: 00080000 00020000 <span class="string">&quot;crash_syslog&quot;</span></span><br><span class="line">mtd12: 023c0000 00020000 <span class="string">&quot;rootfs&quot;</span></span><br><span class="line">mtd13: 023c0000 00020000 <span class="string">&quot;rootfs_1&quot;</span></span><br><span class="line">mtd14: 01ec0000 00020000 <span class="string">&quot;overlay&quot;</span></span><br><span class="line">mtd15: 00080000 00020000 <span class="string">&quot;rsvd0&quot;</span></span><br><span class="line">mtd16: 0041e000 0001f000 <span class="string">&quot;kernel&quot;</span></span><br><span class="line">mtd17: 016c4000 0001f000 <span class="string">&quot;ubi_rootfs&quot;</span></span><br><span class="line">mtd18: 01876000 0001f000 <span class="string">&quot;data&quot;</span></span><br></pre></td></tr></table></figure><p>We’re interested in the <code>bdata</code> partition. go ahead and dump it:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash</span><br><span class="line">$ nanddump -f &#x2F;tmp&#x2F;bdata_mtd9.img &#x2F;dev&#x2F;mtd9</span><br></pre></td></tr></table></figure><p>then copy it to your machine. If you’re using linux, then the following command should work:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ scp root@192.168.31.1:/tmp/bdata_mtd9.img /path/to/ax3600-files/bdata</span><br></pre></td></tr></table></figure><p>If you open it up in a hex editor, you’ll notice a few weird bytes in the beginning then a few ASCII encoded strings, a looooot of zeroes and some other bytes in the end. the first four bytes are the CRC32 checksum for the bdata partition and the strings indicate the devices configuration. you probably recognize some of them, since you’ve updated them when turning on ssh on the device!</p><p>You can also look at the header by running the <code>header.py</code> provided script. just cd to the <code>scripts</code> directory and issue the following command:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./header.py extract ../bdata/bdata_mtd9.img</span><br><span class="line">CRC32: 17 27 E1 B2</span><br><span class="line">color: 101</span><br><span class="line">CountryCode: CN</span><br><span class="line">SN: 11233/A0C123456</span><br><span class="line">model: R3600</span><br><span class="line">miot_did: 112233444</span><br><span class="line">miot_key: aap0blsq5aQbVFmi</span><br><span class="line">telnet_en: 0</span><br><span class="line">ssh_en: 0</span><br><span class="line">uart_en: 0</span><br><span class="line">wl0_ssid: Xiaomi_EA69_5G</span><br><span class="line">wl1_ssid: Xiaomi_EA69</span><br><span class="line">wl2_ssid: Xiaomi_EA69</span><br></pre></td></tr></table></figure><p>We want to update these values to enable ssh on boot. Since <a href="https://en.wikipedia.org/wiki/Dropbear_(software)" rel="noopener" target="_blank">dropbear</a> is not turned on by default, you need to enable telnet as well. Actually, if we’re going to mess with the router, why not turn on the router’s serial port so you could flash the entire thing if you break it? Darell Tan’s got a <a href="https://irq5.io/2020/08/10/custom-firmware-for-the-xiaomi-ax3600-wireless-router" rel="noopener" target="_blank">nice post</a> on customizing the firmware through serial. great read!</p><p>Moreover, in the next post I’ll write about the weird stuff I found on the router. Some of these stuff only run if the router’s Country Code is set to <code>CN</code>, so why not change it to <code>US</code>? this is not random! when you change the country code to something other than CN, the router behaves a bit differently. for instance, it performs online checks against <code>google</code> &amp; <code>microsoft</code> instead of <code>baidu</code> &amp; <code>taobao</code>. both are configured in <code>/etc/config/system</code> and accessed by running <code>uci -q get system.netdt.world_domain</code> and <code>uci -q get system.netdt.cn_domain</code> respectively. Don’t believe me? take a look at the <code>check_gateway</code> function in <code>usr/sbin/pppoe-check</code>.</p><p>Once you update the headers, you also need to update the checksum. Don’t worry, <code>header.py</code> does it all for you.<br>First let’s do a test run to make sure we don’t break anything:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./header.py modify --<span class="built_in">test</span> ../bdata/bdata_mtd9.img ../bdata/bdata_mtd9.img.modified</span><br><span class="line">successfully re-assembled header without modifications</span><br></pre></td></tr></table></figure><p>If you got any response other than the above, please <a href="https://github.com/odedlaz/ax3600-files/issues/new" rel="noopener" target="_blank">open an issue!</a> if everything went fine, you can run:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./header.py modify --country US ../bdata/bdata_mtd9.img ../bdata/bdata_mtd9.img.modified</span><br><span class="line">$ ./header.py extract ../bdata/bdata_mtd9.img</span><br><span class="line">CRC32: 27 21 A1 D2</span><br><span class="line">color: 101</span><br><span class="line">CountryCode: US</span><br><span class="line">SN: 11233/A0C123456</span><br><span class="line">model: R3600</span><br><span class="line">miot_did: 112233444</span><br><span class="line">miot_key: aap0blsq5aQbVFmi</span><br><span class="line">telnet_en: 1</span><br><span class="line">ssh_en: 1</span><br><span class="line">uart_en: 1</span><br><span class="line">wl0_ssid: Xiaomi_EA69_5G</span><br><span class="line">wl1_ssid: Xiaomi_EA69</span><br><span class="line">wl2_ssid: Xiaomi_EA69</span><br><span class="line">boot_wait: on</span><br></pre></td></tr></table></figure><p>You’ll notice that the checksum is now updated and <code>CountryCode</code>, <code>telnet_en</code>, <code>ssh_en</code>, <code>uart_en</code> were all changed. Moreover, a new <code>boot_wait</code> config has been added.</p><p>Unfortunately, the bdata partition is read only. You need to make it writable prior to flashing the bdata partition or you’ll get a readonly error:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mtd write /tmp/bdata_mtd9.img bdata</span><br><span class="line">Could not open mtd device: bdata</span><br><span class="line">Can<span class="string">&#x27;t open device for writing!</span></span><br></pre></td></tr></table></figure><p>How? flash a new crash partition. Doing so opens the bdata partition for writing. I was (and still am) quite afraid to do that, since I have no clue what that crash partition contains. A random guy named <code>barnamacko</code> uploaded a crash partition that works <a href="https://forum.openwrt.org/t/xiaomi-ax3600-ssh-guide/65438/24" rel="noopener" target="_blank">on the OpenWRT forum</a>. Flashing an unknown binary from an unknown source on your home router? why not! on a more serious note, I wasn’t keen to do that. I’m not sure what that binary contains, but I do know that it doesn’t modify the filesystem (I checked).</p><p>I recommend you physically connect to the router before performing any of these commands. Some people lost Wi-Fi connectivity when they flashed the crash partition (don’t worry, after removing it Wi-Fi works again!)</p><p>Go ahead and run the following on your computer:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ scp ../crash/crash_unlock.img root@192.168.31.1:/tmp</span><br></pre></td></tr></table></figure><p>Then login to the router and flash it:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mtd write /tmp/crash_unlock.img crash</span><br><span class="line">$ reboot</span><br></pre></td></tr></table></figure><p>post reboot, upload the modified bdata partition you created:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ scp ..&#x2F;bdata&#x2F;bdata_mtd9.img.modified root@192.168.31.1:&#x2F;tmp</span><br></pre></td></tr></table></figure><p>and flash it:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mtd write &#x2F;tmp&#x2F;bdata_mtd9.img.modified bdata</span><br><span class="line">$ reboot</span><br></pre></td></tr></table></figure><p>After reboot, login to your router again and remove the crash partition:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mtd erase crash</span><br></pre></td></tr></table></figure><p>Then perform a factory reset on the device by surfing to: <code>http://192.168.31.1/cgi-bin/luci/;stok=&lt;STOK&gt;/web/setting/upgrade</code>. This step is important because otherwise you might bump into upgrade verification issues.</p><p>After the reset, you can upgrade to the latest firmware! If you do so, you’ll lose ssh connectivity. Don’t worry, you can connect to the device via telnet:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ telnet 192.168.31.1 23</span><br><span class="line">XiaoQiang login: root</span><br><span class="line">Password:</span><br></pre></td></tr></table></figure><p>Oh snap! what’s the password? well, after you patched the router and upgraded the firmware, the ssh password you set beforehand got reset. dear didiaoing created a website that generates the password for you! all you need to do is fill in the router’s SN number and get the default password. There’s nothing bad about sending your routers SN to a random website which performs all the calculation on the backend, right? I had to do some digging in order to find the algorithm that’s being usedd to generate those :)</p><p>thankfully, I found another chinese guy that goes by the alias zhoujiazhao, that <a href="https://blog.csdn.net/zhoujiazhao/article/details/102578244" rel="noopener" target="_blank">wrote the algorithm in php</a>. who does that these days?! PHP? really? me to the rescue, I ported it to python. Just run <code>calc_passwd</code> and you’re good to go:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./calc_passwd.py ../bdata/bdata_mtd9.img.modified</span><br><span class="line">1b6e63b5</span><br></pre></td></tr></table></figure><p>By the way, I haven’t encountered password issues, only read about them online. Once I got ssh acsess and reset the password, I flashed <a href="http://cdn.alsgp0.fds.api.mi-img.com/xiaoqiang/rom/r3600/miwifi_r3600_all_6510e_3.0.22_INT.bin" rel="noopener" target="_blank">the international firmware</a> and was able to connect with telnet.</p><p>Once you’ve got shell access, you can turn on ssh by running postman steps (4) to (7), or just reset the password to <code>admin</code>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sed -i <span class="string">&#x27;s/channel=.*/channel=\&quot;debug\&quot;/g&#x27;</span> /etc/init.d/dropbear</span><br><span class="line">$ /etc/init.d/dropbear start</span><br><span class="line">$ <span class="built_in">echo</span> -e <span class="string">&#x27;admin\nadmin&#x27;</span> | passwd root</span><br></pre></td></tr></table></figure><p>Moreover, if you do decide to flash the international firmware, you probably want to change the interface language to English:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ uci <span class="built_in">set</span> luci.main.lang=<span class="string">&#x27;en&#x27;</span></span><br><span class="line">$ uci commit</span><br></pre></td></tr></table></figure><p>Don’t forget to turn off telnet after you verify ssh is working:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nvram <span class="built_in">set</span> telnet_en=0</span><br><span class="line">$ nvram commit</span><br></pre></td></tr></table></figure><p>That’s it folks! I hope you won’t need to do any of this once the guys at OpenWRT finish porting it to AX3600 :)</p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="AX3600 - Post #1" data-a2a-url="https://oded.dev/2020/11/30/AX3600-1/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-AX3600-0" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2020/10/23/AX3600-0/" class="article-title">AX3600 - Post #0</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2020/10/23/AX3600-0/"><time datetime="2020-10-23T13:34:10.000Z" itemprop="datePublished">2020-10-23</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/hacking/" class="article-category-link">hacking</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/ax3600/" rel="tag" class="tag-link-link">ax3600</a>, <a href="/tags/linux/" rel="tag" class="tag-link-link">linux</a>, <a href="/tags/xiaomi/" rel="tag" class="tag-link-link">xiaomi</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Wow. last time I wrote anything was ~2 years ago. I actually spent a whole day on getting the blog to working state!<br>Anyhow, I’m back and I’ve got some cool stuff to share. Hopefully I’ll keep posting things regularly…</p><p>So… what are we going to talk about today? A router! and not just any router - <a href="https://www.mi.com/global/mi-aiot-router-ax3600" rel="noopener" target="_blank">Mi AIoT Router AX3600</a>!</p><p>I have at least three posts for this topic:</p><ol><li>Why I bought it &amp; my journey into getting persistent ssh on the device</li><li>All the weird stuff that Xiaomi put on the router and how to disable them</li><li>How to turn off all wierd stuff Xiaomi put on it</li></ol><p>Let’s get this started, shall we?</p><h1 id="The-Good"><a href="#The-Good" class="headerlink" title="The Good"></a>The Good</h1><p>AX3600 is, to the best of my knowledge, the most affordable router with carrier-grade hardware. The AX3600 runs on Qualcomms’s <a href="https://www.qualcomm.com/products/qualcomm-networking-pro-600-platform" rel="noopener" target="_blank">Networking Pro 600</a> (IPQ8071 SoC) which would be quite expensive if bought from other reputable manufacturers.</p><p>Xiaomi did something incredible: they packaged all this power into a nice housing and priced it undress 100$. Yes, you read that correctly - a carrier-grade, WiFi 6 router that costs under 100$. I actually bought it from AliExpress for 130$, including shipping!</p><h1 id="The-Bad"><a href="#The-Bad" class="headerlink" title="The Bad"></a>The Bad</h1><p>Xiaomi didn’t have a global version of the router so the whole interface would be in chinese. That’s a bummer, but I hoped that the guys at OpenWRT would work on porting that beautiful platform to the AX3600. <a href="https://forum.openwrt.org/t/adding-openwrt-support-for-xiaomi-ax3600" rel="noopener" target="_blank">There was a lot of work being done</a> on the router a few months ago so I thought that a port is around the corner. Fast forwardt to November 2020 and it looks like it might take a while.</p><p>On the flip side, Xiaomi forked OpenWRT and the guys there found a command injection vulnerability that allowed them to start an ssh server (<a href="https://matt.ucc.asn.au/dropbear/dropbear.html" rel="noopener" target="_blank">dropbear</a>) and gain root on the device.</p><h1 id="The-Ugly"><a href="#The-Ugly" class="headerlink" title="The Ugly"></a>The Ugly</h1><p>I guess most of you heard that some chinese manufacturers spy on you. right? There was a lot of talk about Huawei which got eventually banned from being used by any U.S federal authority. The verge actually <a href="https://www.theverge.com/2020/6/30/21308477/fcc-huawei-zte-ban-universal-service-fund-national-security-threat-risk" rel="noopener" target="_blank">wrote a piece about that a few months ago</a>.</p><p>I initially thought this is BS and that Xiaomi wouldn’t do that. After dissecting the firmware for the last few weeks I can honestly say that I’m not so sure anymore.</p><h1 id="Now-What"><a href="#Now-What" class="headerlink" title="Now What?"></a>Now What?</h1><p>I wrote a few tools (<a href="https://github.com/odedlaz/ax3600-files" rel="noopener" target="_blank">odedlaz/ax3600-files</a>) to help me customize the router’s firmware. I’ll write about them and the steps needed to gain persistent ssh in the first technical post in the series.</p><p>Stay tuned!</p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="AX3600 - Post #0" data-a2a-url="https://oded.dev/2020/10/23/AX3600-0/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-wips_weather" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2018/01/12/wips_weather/" class="article-title">Getting an Accurate Weather Forecast using Wi-Fi Position System</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2018/01/12/wips_weather/"><time datetime="2018-01-12T21:01:09.000Z" itemprop="datePublished">2018-01-12</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/devops/" class="article-category-link">devops</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/linux/" rel="tag" class="tag-link-link">linux</a>, <a href="/tags/python/" rel="tag" class="tag-link-link">python</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>I’m travelling a lot with my laptop, and having an accurate weather forecast on-the-go is very convenient.</p><p><img src="/images/2018/01/10_day_forecast.png"></p><p>I’m using <a href="https://getfedora.org/" rel="noopener" target="_blank">Fedora</a> as my main (and only) OS, along with <a href="https://i3wm.org/" rel="noopener" target="_blank">i3wm</a> and <a href="https://github.com/jaagr/polybar" rel="noopener" target="_blank">polybar</a>. Previously I used <a href="https://www.gnome.org/gnome-3" rel="noopener" target="_blank">GNOME 3</a> which had a few weather widgets. The most feature-rich was <a href="https://extensions.gnome.org/extension/750/openweather" rel="noopener" target="_blank">OpenWeather</a>, which worked pretty well.</p><p><a href="https://github.com/jaagr/polybar" rel="noopener" target="_blank">polybar</a> doesn’t have a native weather widget and the one’s at <a href="https://github.com/x70b1/polybar-scripts" rel="noopener" target="_blank">x70b1/polybar-scripts</a> suffered from the same drawbacks that OpenWeather did: location had to be manually specified or was ip-geolocation based (which is not accurate enough)</p><p>How do I get an accurate location without a GPS? WiPS to the rescue!</p><h2 id="Wi-Fi-Positioning-System"><a href="#Wi-Fi-Positioning-System" class="headerlink" title="Wi-Fi Positioning System"></a>Wi-Fi Positioning System</h2><p>Did you ever notice that you can get accurate location data when your GPS is turned off? The trick is to measure Wi-Fi signal intensity in order to triangulate your location.</p><p>Google, for instance, tracks open access points when you walk around and upload these along with your GPS location. When your GPS is turned off, they can use the access points around you to calculate your GPS coordinates. Cool right?</p><p>Lifewire <a href="https://www.lifewire.com/wifi-positioning-system-1683343" rel="noopener" target="_blank">published an explanation about Wi-Fi triangulation</a> a few months ago, and Wikipedia has a <a href="https://en.wikipedia.org/wiki/Wi-Fi_positioning_system" rel="noopener" target="_blank">nice article on the subject</a> as well.</p><h2 id="Getting-Accurate-Geolocation"><a href="#Getting-Accurate-Geolocation" class="headerlink" title="Getting Accurate Geolocation"></a>Getting Accurate Geolocation</h2><p>Google Maps has a neat <a href="https://developers.google.com/maps/documentation/geolocation" rel="noopener" target="_blank">Geolocation API</a> that gives accurate location data if supplied with the MAC addresses of surrounding access points.</p><p>I can use <a href="https://linux.die.net/man/8/iw" rel="noopener" target="_blank">iw</a> to extract these by running:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ iw &lt;iface&gt; scan | grep -io <span class="string">&quot;[0-9A-F]\&#123;2\&#125;\(:[0-9A-F]\&#123;2\&#125;\)\&#123;5\&#125;&quot;</span> | uniq</span><br></pre></td></tr></table></figure><p>But how the heck do I get the wireless interfaces? well, there’s <code>/proc/net/wireless</code> for that -</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_wireless_interfaces</span>():</span></span><br><span class="line">    iface_rx = re.compile(<span class="string">&#x27;^(.*): &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># I love one-liners. Hope that doesn&#x27;t look like perl :)</span></span><br><span class="line">    <span class="comment"># - open() returns a read-only file wrapper that is iterable</span></span><br><span class="line">    <span class="comment"># - map() executes re.match() on each line returned from open()</span></span><br><span class="line">    <span class="comment"># - &#x27;yield from&#x27; is used to delegate the generator were creating to another generator</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> (m.group(<span class="number">1</span>) <span class="keyword">for</span> m</span><br><span class="line">                <span class="keyword">in</span> map(iface_rx.match, open(<span class="string">&#x27;/proc/net/wireless&#x27;</span>))</span><br><span class="line">                <span class="keyword">if</span> m)</span><br></pre></td></tr></table></figure><p>Now, I need to to run <code>iw</code>. Running system commands from python is a pain in the ass.<br>unless you use the mighty <a href="https://github.com/amoffat/sh" rel="noopener" target="_blank">sh</a> package, that is!</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sh</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_access_points_addresses</span>():</span></span><br><span class="line">    rx = re.compile(<span class="string">&#x27;([0-9A-F]&#123;2&#125;(:[0-9A-F]&#123;2&#125;)&#123;5&#125;)&#x27;</span>, re.IGNORECASE)</span><br><span class="line">    <span class="keyword">for</span> iface <span class="keyword">in</span> get_wireless_interfaces():</span><br><span class="line">        matches = rx.findall(sh.iw(iface, <span class="string">&quot;scan&quot;</span>).stdout.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> (x[<span class="number">0</span>].strip().lower() <span class="keyword">for</span> x <span class="keyword">in</span> matches)</span><br></pre></td></tr></table></figure><p>And now all that’s left is to kindly ask google to give us our location.<br><code>urllib</code> is a pain, so I’m using <a href="http://docs.python-requests.org/" rel="noopener" target="_blank">requests</a> instead.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_geolocation</span>():</span></span><br><span class="line">    <span class="comment"># &quot;considerIP&quot; flags indicates if google should fallback to ip-based</span></span><br><span class="line">    <span class="comment"># geolocation if it can&#x27;t find your ip using the given access points.</span></span><br><span class="line">    data = &#123;<span class="string">&quot;considerIp&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&quot;wifiAccessPoints&quot;</span>: [&#123;<span class="string">&quot;macAddress&quot;</span>: hwaddr&#125;</span><br><span class="line">                                 <span class="keyword">for</span> hwaddr <span class="keyword">in</span> set(get_access_points())] &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    r = requests.post(<span class="string">&quot;https://www.googleapis.com/geolocation/v1/geolocate&quot;</span>,</span><br><span class="line">                      json=data,</span><br><span class="line">                      params=&#123;<span class="string">&quot;key&quot;</span>: GOOGLE_MAPS_API_ACCESS_KEY &#125;)</span><br><span class="line"></span><br><span class="line">    r.raise_for_status()</span><br><span class="line"></span><br><span class="line">    location = r.json()[<span class="string">&quot;location&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> location[<span class="string">&quot;lng&quot;</span>], location[<span class="string">&quot;lat&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="Getting-Weather-Forecast"><a href="#Getting-Weather-Forecast" class="headerlink" title="Getting Weather Forecast"></a>Getting Weather Forecast</h2><p><a href="https://extensions.gnome.org/extension/750/openweather/" rel="noopener" target="_blank">OpenWeather</a> widget used <a href="http://openweathermap.org/" rel="noopener" target="_blank">OpenWeatherMap</a> API to get up-to-date weather forecast, so I used it as well.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_weather_forecast</span>(<span class="params">longitude, latitude</span>):</span></span><br><span class="line">    <span class="comment"># I&#x27;m living in a country that uses a unit system that makes sense.</span></span><br><span class="line">    params = &#123;<span class="string">&quot;units&quot;</span>: <span class="string">&quot;metric&quot;</span>,</span><br><span class="line">              <span class="string">&quot;appid&quot;</span>: OPEN_WEATHER_MAP_API_KEY,</span><br><span class="line">              <span class="string">&quot;lat&quot;</span>: latitude, <span class="string">&quot;lon&quot;</span>: longitude&#125;</span><br><span class="line"></span><br><span class="line">    resp = requests.get(<span class="string">&quot;https://api.openweathermap.org/data/2.5/weather&quot;</span>,</span><br><span class="line">                        params=params)</span><br><span class="line"></span><br><span class="line">    resp.raise_for_status()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp.json()</span><br></pre></td></tr></table></figure><p>And viola!</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">longitude, latitude = get_geolocation()</span><br><span class="line">forecast = get_weather_forecast(longitude, latitude)</span><br><span class="line">print((<span class="string">f&quot;<span class="subst">&#123;forecast[<span class="string">&#x27;name&#x27;</span>]&#125;</span> &quot;</span></span><br><span class="line">       <span class="string">f&quot;<span class="subst">&#123;forecast[<span class="string">&#x27;main&#x27;</span>][<span class="string">&#x27;temp&#x27;</span>]:<span class="number">.0</span>f&#125;</span>°C &quot;</span></span><br><span class="line">       <span class="string">f&quot;[<span class="subst">&#123;forecast[<span class="string">&#x27;weather&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;main&#x27;</span>]&#125;</span>]&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tel-Aviv 18°C [Clear]</span></span><br></pre></td></tr></table></figure></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="Getting an Accurate Weather Forecast using Wi-Fi Position System" data-a2a-url="https://oded.dev/2018/01/12/wips_weather/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-not_an_lang_dev" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2017/11/28/not_an_lang_dev/" class="article-title">You&#39;re not a Java Developer</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/11/28/not_an_lang_dev/"><time datetime="2017-11-28T08:53:00.000Z" itemprop="datePublished">2017-11-28</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/thoughts/" class="article-category-link">thoughts</a><i class="fa fa-angle-right"></i><a href="/categories/thoughts/programming/" class="article-category-link">programming</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>You are not a “Java Developer”.<br>You are a Software Developer who is capable of writing software in Java.</p><p>You don’t want to hire people that call themselves “Java Developers”.<br>You want to hire devs that either have extensive knowledge in Java (and are also good software developers), or hire superb developers that don’t, but can close the gap quickly.</p><p>Java, or any other language for that matter, is just syntax. Learning a language is a long process, which consists of:</p><ul><li>Understanding how to write good software with it</li><li>Understanding How the language works under the hood</li><li>Understanding What are the language’s limitations</li><li>Understanding which problems are good to solve with it, and more importantly - which aren’t.</li><li>Learning the eco-system: libraries, tooling, etc’</li></ul><p><strong>I can’t stress that enough.</strong></p><p>The language does not define you. What does?</p><ul><li>Your ability to make the right architectural decisions</li><li>Your ability to take responsibility for your work</li><li>Your ability to grasp new ideas</li><li>Your ability to learn new languages &amp; technologies quickly</li><li>Your passion for software crafstmanship &amp; understanding that you have to constantly learn in order to be good at it.</li></ul><p>You don’t want to be an “X Developer”, because that means that you are only expected to know <em>X</em>. IMO, that means that you have only one tool in your toolbox which you use to solve every problem.</p><p>You want to learn new languages, new operation systems, new tools, new techniques.<br>Each one teaches you new ways to reason about &amp; solve problems.</p><p>Java is very good language for a given set of problems. It’s a very bad language for others. Furthermore, Java has it’s own view on how to solve problems. Haskell, for example, look at &amp; solves problems in a completely different way.</p><p>The “I’m an X Developer” kind of people look at (and reason about) problems from the wrong angle. Instead of looking at a problem and searching for the right tool to solve it, They use the tools they feel comfortable with in order to solve it.</p><p><img src="/images/2017/11/wrench_hammer_nailgun.png"></p><p>Don’t get me wrong, being proficient in a specific domain (which might be a language and its ecosystem) is important, but the domain does not define you and you should not limit yourself to only one.</p><p>The way I see it, there is no such thing as a “Java Developer”, there’s a developer that is proficient in Java. This subtlety is important.</p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="You're not a Java Developer" data-a2a-url="https://oded.dev/2017/11/28/not_an_lang_dev/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-fedora_uefi" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2017/11/13/fedora_uefi/" class="article-title">Migrating Fedora from BIOS to UEFI</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/11/13/fedora_uefi/"><time datetime="2017-11-13T15:21:13.000Z" itemprop="datePublished">2017-11-13</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/devops/" class="article-category-link">devops</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/linux/" rel="tag" class="tag-link-link">linux</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Let me tell you a story.</p><p>This is not a sad story, but a geeky one.</p><p>A story about a developer that was told it’s impossible to migrate his Fedora OS from BIOS to UEFI, and against all odds, succeeded.</p><p><img src="/images/2017/11/xkcd-obsolete-tech.jpg"></p><p>A few months ago I started working at a new place and got a shiny <a href="http://www.dell.com/en-us/shop/dell-laptops/xps-15/spd/xps-15-9560-laptop" rel="noopener" target="_blank">Dell XPS 9560</a>.</p><p>The spec was amazing: Top of the line CPU, GPU, 4k screen and even 32gb of RAM!</p><p>But the issues.. oh… the issues. Thank god most of them are solvable by a simple firmare upgrade. The rest are GPU issues which led me to disable the embedded NVIDIA GPU (which I don’t need anyway).</p><p>Ok, so how do I upgrade the firmware? <code>fwupd</code> comes to the rescue:</p><blockquote><p><em>“<strong>fwupd</strong> is an open source daemon for managing the installation of firmware updates on Linux-based systems, developed by GNOME maintainer Richard Hughes…”</em> - <a href="https://en.wikipedia.org/wiki/Fwupd" rel="noopener" target="_blank">Wikipedia</a>.</p></blockquote><p>I was a few keystrokes away from getting all my issues solved!<br>Dell <a href="https://blogs.gnome.org/hughsie/2017/02/08/new-fwupd-release-and-why-you-should-buy-a-dell/" rel="noopener" target="_blank">put in a lot of effort</a> to make sure <a href="https://github.com/hughsie/fwupd" rel="noopener" target="_blank">fwupd</a> works great with their products, So I wasn’t suprised that my laptop is <a href="https://fwupd.org/lvfs/device/34578c72-11dc-4378-bc7f-b643866f598c" rel="noopener" target="_blank">supported</a>.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ fwupdmgr refresh</span><br><span class="line">$ fwupdmgr update</span><br><span class="line">No devices can be updated: Nothing to <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">$ fwupdate --supported</span><br><span class="line">Firmware updates are not supported on this machine.</span><br></pre></td></tr></table></figure><p>What?! but why?! <code>fwupdmgr</code> recognizes my devices:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ fwupdmgr get-devices</span><br><span class="line">Intel AMT (unprovisioned)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">XPS 15 9560 System Firmware</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Integrated Webcam HD</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">GP107M [GeForce GTX 1050 Mobile]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>So what’s wrong? I’m connected to AC, I’m running as root, I got <a href="http://www.dell.com/support/article/us/en/19/sln171755/updating-the-dell-bios-in-linux-and-ubuntu-environments?lang=en" rel="noopener" target="_blank">UEFI Capsule Updates</a> turned on.</p><p>Oh wait. I’m not using <a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface" rel="noopener" target="_blank">UEFI</a>. No problem! let’s migrate!</p><p><img src="/images/2017/11/fedora_boot.png" alt="https://docs.fedoraproject.org/f26/install-guide/install/Booting_the_Installation.html"></p><p>My first thought: <em>“Oh shit. I’m f\</em>cked”*. My second thought: <em>“that doesn’t make any sense!</em>.</p><h2 id="Game-Plan"><a href="#Game-Plan" class="headerlink" title="Game Plan"></a>Game Plan</h2><p>All I need is a simple <code>grub-mkconfig</code> while booted in UEFI mode, but how?</p><ol><li>Convert my paritition table to <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table" rel="noopener" target="_blank">GUID Partition Table</a></li><li>Free up some space for an <a href="https://en.wikipedia.org/wiki/EFI_system_partition" rel="noopener" target="_blank">EFI Partition</a> <code>/boot/efi</code> paritition</li><li>Update GRUB to use UEFI</li></ol><p>Before we continue, I want to share we you my own partition table:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Disk &#x2F;dev&#x2F;sda: 953.9 GiB, 1024209543168 bytes, 2000409264 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line">Disklabel type: dos</span><br><span class="line"></span><br><span class="line">Device              Start        End    Sectors   Size Type</span><br><span class="line">&#x2F;dev&#x2F;sda1       2048    1953791    1951744   953M Linux filesystem</span><br><span class="line">&#x2F;dev&#x2F;sda2    1953792   60549119   58595328    28G Linux swap</span><br><span class="line">&#x2F;dev&#x2F;sda3   60549120  493574143  433025024 206.5G Linux filesystem</span><br><span class="line">&#x2F;dev&#x2F;sda4 493574144 1669111807 1175537664 560.6G Linux filesystem</span><br><span class="line">&#x2F;dev&#x2F;sda5 1669111808 2000203775  331091968 157.9G Linux filesystem</span><br></pre></td></tr></table></figure><p>I have two OS’s installed. Arch &amp; Fedora -</p><ul><li><strong>Arch</strong>: <code>/boot</code> is mounted at <code>/dev/sda1</code> and <code>/</code> is mounted at <code>/dev/sda3</code>.</li><li><strong>Fedora</strong>: <code>/</code> is mounted at <code>/dev/sda4</code>.</li></ul><p>Both use <code>/dev/sda2</code> for swap, and <code>/dev/sda5</code> has some other data.<br>I don’t need Arch anymore, and would like to migrate Fedora to UEFI.</p><h2 id="LiveUSB"><a href="#LiveUSB" class="headerlink" title="LiveUSB"></a>LiveUSB</h2><p>I know that most of the changes I had to do couldn’t be done on mounted volumes, ,so I had to use a LiveCD. But nobody uses LiveCD’s nowadays - LiveUSB is the word on the streets.</p><p>I had two options. Either <a href="https://fedoraproject.org/wiki/FedorlaLiveCD" rel="noopener" target="_blank">Download</a> a LiveCD and burn it, or use <a href="https://fedoraproject.org/wiki/How_to_create_and_use_Live_USB" rel="noopener" target="_blank">Fedora Media Writer</a>.</p><h2 id="Booting-into-UEFI-mode"><a href="#Booting-into-UEFI-mode" class="headerlink" title="Booting into UEFI mode"></a>Booting into UEFI mode</h2><p>First of all - I changed my BIOS configuration to boot up in UEFI mode.<br>Then, because I’m paranoid, I checked that I’m actually booted up in EFI mode:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo efibootmgr</span><br><span class="line">EFI variables are not supported on this system.</span><br></pre></td></tr></table></figure><p>Damn! that meant I wasn’t loaded into EFI, but I was ??</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo modprobe efivarfs</span><br><span class="line">$ sudo efibootmgr</span><br><span class="line">BootCurrent: 0013</span><br><span class="line">Timeout: 0 seconds</span><br><span class="line">BootOrder: 0000</span><br><span class="line">Boot0000  Fedora</span><br></pre></td></tr></table></figure><p>Bam!</p><h2 id="Convert-parition-table-to-GPT"><a href="#Convert-parition-table-to-GPT" class="headerlink" title="Convert parition table to GPT"></a>Convert parition table to GPT</h2><p>I got the LiveUSB installed on a company thumb drive. Now I need to convert my paritition table from dos to GUID (GPT).</p><p>This step is rather simple. I Used <a href="https://www.rodsbooks.com/gdisk" rel="noopener" target="_blank">gdisk</a>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># shouldn&#x27;t require a password</span></span><br><span class="line">$ su</span><br><span class="line">$ gdisk /dev/your/device</span><br><span class="line"><span class="comment"># gdisk will now prompt that it wants to convert the partition table.</span></span><br><span class="line"><span class="comment"># press &#x27;w&#x27; to save and you&#x27;re done.</span></span><br></pre></td></tr></table></figure><h2 id="Free-up-space"><a href="#Free-up-space" class="headerlink" title="Free up space"></a>Free up space</h2><p>I actually had another OS installed at the beginning of the partition table which I didn’t use anymore, so I just deleted it and recreated the EFI parition there.</p><p>If you don’t have one, install <a href="https://gparted.org/" rel="noopener" target="_blank">GParted</a> and use it to free up ~500mb.</p><p>A few notes:</p><ul><li>The EFI boot parition can be shared between OS’s. if you have one for Windows, no need to create another one.</li><li>The parition location isn’t important - it doesn’t have to reside in the beginning of the block for instance.</li><li>A parition size of ~500mb should suffice.</li></ul><h2 id="Update-GRUB"><a href="#Update-GRUB" class="headerlink" title="Update GRUB"></a>Update GRUB</h2><h3 id="Recap"><a href="#Recap" class="headerlink" title="Recap"></a>Recap</h3><p>I’ve got a new <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table" rel="noopener" target="_blank">GPT partition table</a> with an <a href="https://en.wikipedia.org/wiki/EFI_system_partition" rel="noopener" target="_blank">EFI partition</a> at the beginning:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Disk &#x2F;dev&#x2F;sda: 953.9 GiB, 1024209543168 bytes, 2000409264 sectors</span><br><span class="line">Units: sectors of 1 * 512 &#x3D; 512 bytes</span><br><span class="line">Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes</span><br><span class="line">I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</span><br><span class="line">Disklabel type: gpt</span><br><span class="line"></span><br><span class="line">Device              Start        End    Sectors   Size Type</span><br><span class="line">&#x2F;dev&#x2F;sda6       2048    1953791    1951744   953M EFI System</span><br><span class="line">&#x2F;dev&#x2F;sda7    1953792   60549119   58595328    28G Linux swap</span><br><span class="line">&#x2F;dev&#x2F;sda4   60549120 1669111807 1175537664 413.1G Linux filesystem</span><br><span class="line">&#x2F;dev&#x2F;sda5 1669111808 2000203775  331091968 157.9G Linux filesystem</span><br></pre></td></tr></table></figure><h3 id="chroot"><a href="#chroot" class="headerlink" title="chroot"></a>chroot</h3><p>I need <code>Fedora</code> to mount <code>/boot/efi</code> on boot, and configured to use UEFI. <a href="https://en.wikipedia.org/wiki/Chroot" rel="noopener" target="_blank">chroot</a> to the rescue!</p><p>For those of you that have never heard of <strong>c</strong>hange <strong>root</strong>, <a href="https://en.wikipedia.org/wiki/Chroot" rel="noopener" target="_blank">Wikipedia</a> provides a good explanation:</p><blockquote><p><strong>Chroot</strong> is an operation that changes the apparent root directory for the current running process and their children.</p><p>A program that is run in such a modified environment cannot access files and commands outside that environmental directory tree. This modified environment is called a chroot jail.</p></blockquote><p>So back to where we were… Let’s chroot and get this over with.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># just login as root</span></span><br><span class="line">$ sudo su</span><br><span class="line"><span class="comment"># mounting  everything</span></span><br><span class="line">$ mount /dev/sda4 /mnt/fedora</span><br><span class="line">$ mount /dev/sda6 /mnt/fedora/boot/efi</span><br><span class="line">$ mount -t proc proc /mnt/fedora/proc/</span><br><span class="line">$ mount --rbind /sys /mnt/fedora/sys/</span><br><span class="line">$ mount -t efivarfs efivarfs /sys/firmware/efi/efivars</span><br><span class="line">$ mount --rbind /dev /mnt/fedora/dev/</span><br><span class="line">$ mount --rbind /var /mnt/fedora/var/</span><br><span class="line"></span><br><span class="line"><span class="comment"># copying over the efi mount point</span></span><br><span class="line"><span class="comment"># you might want to comment-out any /boot mounts you might have</span></span><br><span class="line"><span class="comment"># this step is crucial, because we need an fstab entry for the efi partition.</span></span><br><span class="line">$ grep <span class="string">&quot;/boot/efi&quot;</span> /etc/fstab &gt;&gt; /mnt/fedora/etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># chroot into your system</span></span><br><span class="line">$ chroot /mnt/fedora /bin/bash</span><br></pre></td></tr></table></figure><p>Awesome. I’m in my <code>Fedora</code>. Now I need to follow Fedora’s <a href="https://fedoraproject.org/wiki/GRUB_2#Updating_GRUB_2_configuration_on_UEFI_systems" rel="noopener" target="_blank">Updating GRUB 2 configuration on UEFI systems</a>.</p><p>TL;DR:</p><p>Oh wait! My paranoid self keeps asking to check that I have an fstab entry<br>for the efi partition. Let’s give him some peace:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ grep <span class="string">&quot;/boot/efi&quot;</span> /etc/fstab</span><br></pre></td></tr></table></figure><p>Good catch! I forgot to add it previously. Let’s add it:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;/dev/sda6 /boot/efi vfat defaults 0 1&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><p>TL;DR #2:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf reinstall grub2-efi grub2-efi-modules shim</span><br><span class="line">$ sudo grub2-mkconfig -o /boot/efi/EFI/fedora/grub.cfg</span><br></pre></td></tr></table></figure><p>It worked! <code>grub2-mkconfig</code> told me it found <code>Fedora</code>!</p><p>If it didn’t, I could’ve done this step manually:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo efibootmgr --create --disk &#x2F;dev&#x2F;sda --part 6 --loader &#x2F;EFI&#x2F;fedora&#x2F;grubx64.efi --label &quot;Fedora&quot;</span><br></pre></td></tr></table></figure><h2 id="Checking-that-it-all-works"><a href="#Checking-that-it-all-works" class="headerlink" title="Checking that it all works"></a>Checking that it all works</h2><p>I know it sounds stupid, because the OS already booted, but why not?</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ls /sys/firmware/efi/efivars | wc -l</span><br><span class="line">81</span><br><span class="line"></span><br><span class="line">$ efibootmgr</span><br><span class="line">BootCurrent: 0007</span><br><span class="line">Timeout: 0 seconds</span><br><span class="line">BootOrder: 0007</span><br><span class="line">Boot0000* Windows Boot Manager</span><br><span class="line">Boot0006* Linux-Firmware-Updater \fwupx64.efi</span><br><span class="line">Boot0007* Fedora</span><br></pre></td></tr></table></figure><p>See? that wasn’t too hard!</p><h2 id="Upgrading-Firmware"><a href="#Upgrading-Firmware" class="headerlink" title="Upgrading Firmware"></a>Upgrading Firmware</h2><p>After I did all that, I reran <code>fwupd</code>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ fwupdate --supported</span><br><span class="line">Firmware updates are supported on this machine.</span><br></pre></td></tr></table></figure><p>Yay!</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ fwupdmgr refresh</span><br><span class="line">$ fwupdmgr update</span><br><span class="line">...</span><br><span class="line">$ reboot</span><br></pre></td></tr></table></figure><p>Done. By the way, <em>ALL</em> the issues I previously had were gone after upgrading!<br><img src="/images/2017/11/sorry_potato.jpg"></p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="Migrating Fedora from BIOS to UEFI" data-a2a-url="https://oded.dev/2017/11/13/fedora_uefi/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-guts-n-glory-of-db-internals" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2017/11/07/guts-n-glory-of-db-internals/" class="article-title">The Guts n’ Glory of Database Internals</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/11/07/guts-n-glory-of-db-internals/"><time datetime="2017-11-07T10:16:37.000Z" itemprop="datePublished">2017-11-07</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/devops/" class="article-category-link">devops</a><i class="fa fa-angle-right"></i><a href="/categories/devops/programming/" class="article-category-link">programming</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/databases/" rel="tag" class="tag-link-link">databases</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>A year ago <a href="https://ayende.com/" rel="noopener" target="_blank">Oren Eini</a> (a.k.a <a href="https://twitter.com/ayende" rel="noopener" target="_blank">@ayende</a>) wrote a series dubbed <a href="https://ayende.com/blog/posts/series/174337/the-guts-n-glory-of-database-internals" rel="noopener" target="_blank"><em>“The Guts n’ Glory of Database Internals”</em></a>.</p><p>Instead of just explaining how databases work, He incrementally builds a database from scratch. He goes over most database essentials, so once done you’ll be able to understand how databases actually work. If you haven’t taken any database courses at Uni, this is a must in my opinion.</p><p>The series is built around a “book keeping’ system. The problem? We need to keep track of users and how often they log into the system</p><p>He begins at persisting the data to a simple csv file, and then raises issues with this solution. The next part in the series addresses those issues and raises new ones: from selection time, concurrency, durability, logging and more.</p><p>Each part builds upon the previous and most parts take around 5 minutes to read.<br>The series is made up of 20 parts and takes ~ 1.5hrs to read from start to finish. Not so bad, right?</p><p>By the way, <a href="https://twitter.com/ayende" rel="noopener" target="_blank">@ayende</a> writes <em>really</em> well, so it’s also fun to read:</p><ol><li><a href="https://ayende.com/blog/174337/the-guts-n-glory-of-database-internals-persisting-information" rel="noopener" target="_blank">Persisting information</a> | 6 minutes</li><li><a href="https://ayende.com/blog/174369/the-guts-n-glory-of-database-internals-searching-information-and-file-format" rel="noopener" target="_blank">Searching information and file format</a> | 4 minutes</li><li><a href="https://ayende.com/blog/174370/the-guts-n-glory-of-database-internals-the-lsm-option" rel="noopener" target="_blank">The LSM option</a> | 3 minutes</li><li><a href="https://ayende.com/blog/174402/the-guts-n-glory-of-database-internals-b-tree" rel="noopener" target="_blank">B+ Tree</a> | 11 minutes</li><li><a href="https://ayende.com/blog/174465/the-guts-n-glory-of-database-internals-seeing-the-forest-for-the-trees" rel="noopener" target="_blank">Seeing the forest for the trees</a> | 4 minutes</li><li><a href="https://ayende.com/blog/174561/the-guts-n-glory-of-database-internals-managing-records" rel="noopener" target="_blank">Managing Records</a> | 7 minutes</li><li><a href="https://ayende.com/blog/174562/the-guts-n-glory-of-database-internals-managing-concurrency" rel="noopener" target="_blank">Managing Concurrency</a> | 6 minutes</li><li><a href="https://ayende.com/blog/174563/the-guts-n-glory-of-database-internals-understanding-durability-with-hard-disks" rel="noopener" target="_blank">Understanding durability with hard disks</a> | 6 minutes</li><li><a href="https://ayende.com/blog/174564/the-guts-n-glory-of-database-internals-durability-in-the-real-world" rel="noopener" target="_blank">Durability in the real world</a> | 4 minutess</li><li><a href="https://ayende.com/blog/174565/the-guts-n-glory-of-database-internals-getting-durable-faster" rel="noopener" target="_blank">Getting durable, faster</a> | 3 minutes</li><li><a href="https://ayende.com/blog/174566/the-guts-n-glory-of-database-internals-writing-to-a-data-file" rel="noopener" target="_blank">Writing to a data file</a> | 3 minutes</li><li><a href="https://ayende.com/blog/174593/the-guts-n-glory-of-database-internals-the-enemy-of-thy-database-is" rel="noopener" target="_blank">The enemy of thy database is…</a> | 4 minutes</li><li><a href="https://ayende.com/blog/174594/the-guts-n-glory-of-database-internals-the-communication-protocol" rel="noopener" target="_blank">The communication protocol</a> | 4 minutes</li><li><a href="https://ayende.com/blog/174625/the-guts-n-glory-of-database-internals-backup-restore-and-the-environment" rel="noopener" target="_blank">Backup, restore and the environment…</a> | 4 minutes</li><li><a href="https://ayende.com/blog/174657/the-guts-n-glory-of-database-internals-the-curse-of-old-age" rel="noopener" target="_blank">The curse of old age…</a> | 5 minutes</li><li><a href="https://ayende.com/blog/174659/the-guts-n-glory-of-database-internals-what-the-disk-can-do-for-you" rel="noopener" target="_blank">What the disk can do for you</a> | 2 minutes</li><li><a href="https://ayende.com/blog/174916/the-guts-n-glory-of-database-internals-what-goes-inside-the-transaction-journal" rel="noopener" target="_blank">What goes inside the transaction journal</a> | 8 minutes</li><li><a href="https://ayende.com/blog/174917/the-guts-n-glory-of-database-internals-log-shipping-and-point-in-time-recovery" rel="noopener" target="_blank">Log shipping and point in time recovery</a> | 3 minutes</li><li><a href="https://ayende.com/blog/174945/the-guts-n-glory-of-database-internals-merging-transactions" rel="noopener" target="_blank">Merging transactions</a> | 4 minutes</li><li><a href="https://ayende.com/blog/174946/the-guts-n-glory-of-database-internals-early-lock-release" rel="noopener" target="_blank">Early lock release</a> | 2 minutes</li></ol></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="The Guts n’ Glory of Database Internals" data-a2a-url="https://oded.dev/2017/11/07/guts-n-glory-of-db-internals/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-modern-cpp" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2017/11/06/modern-cpp/" class="article-title">My take on Modern C++</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/11/06/modern-cpp/"><time datetime="2017-11-06T07:27:12.000Z" itemprop="datePublished">2017-11-06</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/programming/" class="article-category-link">programming</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/c/" rel="tag" class="tag-link-link">c++</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>C++ is a big language that has evolved tremendously since it’s inception way back in the 1980’s.</p><p>Throughout the years, many million lines of code have been written in the language and a big portion of that code is using legacy features that aren’t considered good practice anymore.</p><p><img src="/images/2017/11/xkcd-goto.png"></p><h2 id="Replacing-C"><a href="#Replacing-C" class="headerlink" title="Replacing C++?"></a>Replacing C++?</h2><p>There were <em>many</em> attempts to replace the lanaguage. All of them failed as far as I know.</p><p>Some attempts were made to subset the language in order to get rid of code &amp; language dept, which hurt speed and portability.</p><p>The most recent hype is around <a href="https://www.rust-lang.org/" rel="noopener" target="_blank">rust</a>, which is a blazing fast, memory safe systems programming language. I see a promising future for <code>rust</code>, and I’m actually learning it myself. But like Bjarne said in his talk <a href="https://www.youtube.com/watch?v=1OEu9C51K2A" rel="noopener" target="_blank">Writing Good C++14</a>, it would take ~10 years for a good language to make it to the mainstream.</p><p>C++ is already here. We need to find a way for people to write good C++ now.</p><h2 id="Subset-of-Superset"><a href="#Subset-of-Superset" class="headerlink" title="Subset of Superset"></a>Subset of Superset</h2><p>Simply sub-setting the language won’t work. This is backed by previous, failed, attempts. In order to maintain the speed of C++ we need the low-level / tricky / close-to-the-hardware / error-prone / expert-only features. Those feature are the building blocks of for higher-level facilitiese &amp; libraries.</p><p>Bjarne talked about the subject at CPPCon a few years back:</p><iframe allowfullscreen frameborder="0" height="315" src="https://www.youtube-nocookie.com/embed/1OEu9C51K2A?rel=0&amp;start=1063" width="560"></iframe><p>Bjarne said we first need to create a superset of the langauge, then subset it in order to get rid of the crud. In order to do so, we need supporting facilities to make the transition: from guidelines on how to write modern C++, to libraries that enpasulate the usage of messy &amp; dangerous things so most programmers won’t need to use them.</p><h2 id="What-is-Modern-C"><a href="#What-is-Modern-C" class="headerlink" title="What is Modern C++"></a>What is Modern C++</h2><p>What is modern C++? Put simply, C++ that is based on C++1x and uses modern best practices.</p><p>To really grasp the essence of Modern C++, read the <a href="https://github.com/isocpp/CppCoreGuidelines" rel="noopener" target="_blank">Core Guidelines</a>. But nobody does that right?</p><h3 id="Talks-amp-Books"><a href="#Talks-amp-Books" class="headerlink" title="Talks &amp; Books"></a>Talks &amp; Books</h3><p>I really liked Bjarne’s <a href="https://www.youtube.com/watch?v=1OEu9C51K2A" rel="noopener" target="_blank">Writing Good C++14</a>, Neil MacIntosh’s <a href="https://www.youtube.com/watch?v=_GhNnCuaEjo" rel="noopener" target="_blank">The Guideline Support Library: One Year Later</a>, Herb Sutter’s <a href="https://www.youtube.com/watch?v=hEx5DNLWGgA" rel="noopener" target="_blank">Writing Good C++ by Default</a> &amp; <a href="https://www.youtube.com/watch?v=TJHgp1ugKGM" rel="noopener" target="_blank">Modern C++: What You Need to Know</a>.</p><p>I’ve also read parts of <a href="http://www.amazon.com/dp/1491903996" rel="noopener" target="_blank">Effective Modern C++</a> by Scott Meyes and found it useful.</p><h4 id="C-Seasoning"><a href="#C-Seasoning" class="headerlink" title="C++ Seasoning"></a>C++ Seasoning</h4><p>I find <a href="http://sean-parent.stlab.cc/" rel="noopener" target="_blank">Sean Parent</a>‘s C++ Seasoning talk so good that I think you have to see it. I wrote about it in my previous post: <a href="/2017/11/03/cpp-algorithm-series-0">C++ algorithm Series #0</a>.</p><p>The talk takes a look at many of the new features in C++ and a couple of old features you may not have known about. With the goal of correctness in mind, Sean shows how to utilize these features to create simple, clear, and beautiful code.</p><p>TL;DR: No Raw Loops, No Raw Syntonization Primitives, No Raw Pointers.</p><iframe allowfullscreen frameborder="0" height="540" src="https://channel9.msdn.com/Events/GoingNative/2013/Cpp-Seasoning/player" width="960"></iframe><p>Sean also gave another talk on the subject at <a href="https://www.a9.com/" rel="noopener" target="_blank">Amazon’s A9</a> Programming Converstaions course.</p><iframe allowfullscreen frameborder="0" height="315" src="https://www.youtube.com/embed/IzNtM038JuI" width="560"></iframe><iframe allowfullscreen frameborder="0" height="315" src="https://www.youtube.com/embed/vxv74Mjt9_0" width="560"></iframe><h2 id="Writing-Modern-C"><a href="#Writing-Modern-C" class="headerlink" title="Writing Modern C++"></a>Writing Modern C++</h2><p>These are my do’s and don’ts regarding modern c++. There are also other things I do in order to make sure my project’s are written well:</p><ul><li>Use CMake to build your project</li><li>Use memcheck to detect memory leaks</li><li>Run fuzzers to validate input</li><li>and more …</li></ul><p><strong>[!]</strong> Are you using a package manager? please let me know.</p><h3 id="Follow-Well-Known-Guidelines"><a href="#Follow-Well-Known-Guidelines" class="headerlink" title="Follow Well-Known Guidelines"></a>Follow Well-Known Guidelines</h3><p>First, follow <a href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md" rel="noopener" target="_blank">C++ Core Guidlines</a>. You don’t need to actually read it, there are tools like <code>Clang-Tidy</code> that have the core guidelines pre-baked. Once you get a warning please go ahead and read the whole guideline. It’s important to understand <em>Why</em> the guideline exists.</p><p>Second, consider following well-known coding conventions and guidelines. On many occasions you can find tooling that help you follow guidelines created by big projects / corporations.</p><p>For instance, <code>Clang-Format</code> has pre-baked support for LLVM, Google, Chromium, Mozilla &amp; WebKit. <code>Clang-Tidy</code> has pre-baked checks that follow Boost, Google, LLVM and more.</p><h3 id="Use-Popular-Libraries"><a href="#Use-Popular-Libraries" class="headerlink" title="Use Popular Libraries"></a>Use Popular Libraries</h3><p>Use standard / popular libraries as much as possible. I use:</p><ul><li><a href="https://github.com/Microsoft/GSL" rel="noopener" target="_blank">Guidelines Support Library</a></li><li>Google’s <a href="https://abseil.io/" rel="noopener" target="_blank">Abseil</a></li><li><a href="http://stlab.adobe.com/" rel="noopener" target="_blank">Adobe’s Standard Library</a></li><li><a href="https://boost.org/" rel="noopener" target="_blank">Boost</a></li></ul><p>I try to use the [<a href="http://www.cplusplus.com/reference/stl/" rel="noopener" target="_blank">Standard Library</a> as much as possible.</p><h3 id="Compiler-Flags"><a href="#Compiler-Flags" class="headerlink" title="Compiler Flags"></a>Compiler Flags</h3><p>Turn on warnings, and preferebly warnings as errors. I usually turn on <code>Wall</code> and <code>Werror</code>. They are anoyying, but a neccessery evil IMO.</p><h3 id="RAII"><a href="#RAII" class="headerlink" title="RAII"></a>RAII</h3><p>A few days ago I watched a talk called “Modernizing Legacy C++ Code” where they suggested to use <a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization" rel="noopener" target="_blank">RAII</a> everywhere:</p><iframe allowfullscreen frameborder="0" height="315" src="https://www.youtube.com/embed/LDxAgMe6D18?start=1641" width="560"></iframe><p>I’m not suprised, I’m a huge fan of RAII. Not only it makes code cleaner, thus reducing bugs and memory leaks, it also has an extremely low performance impact (compared to golang’s <a href="https://lk4d4.darth.io/posts/defer/" rel="noopener" target="_blank">defer</a>, which is used for the same purpose)</p><p>If Your’e interfacing C code, consider creating a scope guard. I use my home-baked <a href="https://oded.dev/2017/10/05/go-defer-in-cpp/">defer</a>-clone for that purpose.</p><h3 id="Const-Qualify-Everything"><a href="#Const-Qualify-Everything" class="headerlink" title="Const-Qualify Everything"></a>Const-Qualify Everything</h3><p>On “Modernizing Legacy C++ Code” they also talked about using <code>const</code> everywhere. At first it sounded weird, but it actually made a lot of sense once they showed a few examples:</p><iframe allowfullscreen frameborder="0" height="315" src="https://www.youtube.com/embed/LDxAgMe6D18?start=2195" width="560"></iframe><p>This is a rolling release. That is, I’ll keep updating this post with new insights.</p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="My take on Modern C++" data-a2a-url="https://oded.dev/2017/11/06/modern-cpp/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-cpp-algo-0" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2017/11/03/cpp-algo-0/" class="article-title">C++ &lt;algorithm&gt; Series #0</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/11/03/cpp-algo-0/"><time datetime="2017-11-03T12:43:00.000Z" itemprop="datePublished">2017-11-03</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/programming/" class="article-category-link">programming</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/c/" rel="tag" class="tag-link-link">c++</a></div></div></header><div class="article-entry" itemprop="articleBody"><p><img src="/images/2017/11/xkcd-algo.png"></p><p>The more I learn about an eco-system, the more I understand how little I know about it.<br>I’m a master of nothing. There’s always something new to know, and the list only grows.</p><p>This time around it’s C++ that haunts me.</p><p>I recently “binge-watched” a few CPPCon talks:</p><ul><li><a href="https://www.youtube.com/watch?v=LDxAgMe6D18" rel="noopener" target="_blank">Modernizing Legacy C++ Code</a></li><li><a href="https://www.youtube.com/watch?v=1OEu9C51K2A" rel="noopener" target="_blank">Writing Good C++14</a></li><li><a href="https://www.youtube.com/watch?v=bIhUE5uUFOA" rel="noopener" target="_blank">Inheritance Is The Base Class of Evil</a></li><li><a href="https://www.youtube.com/watch?v=D7Sd8A6_fYU" rel="noopener" target="_blank">extern c: Talking to C Programmers about C++</a></li><li><a href="https://www.youtube.com/watch?v=xcpSLRpOMJM" rel="noopener" target="_blank">Object Oriented Programming without Inheritance</a></li></ul><p>They were awesome, but one talk really got my attention - <a href="https://channel9.msdn.com/Events/GoingNative/2013/Cpp-Seasoning" rel="noopener" target="_blank">C++ Seasoning</a> by <a href="http://sean-parent.stlab.cc/papers-and-presentations" rel="noopener" target="_blank">Sean Parent</a>.</p><p>I have this <em>“I don’t know anything about programming”</em> feeling every time I watch a <a href="https://changelog.com/posts/rich-hickeys-greatest-hits" rel="noopener" target="_blank">Rich Hickey</a> talk.<br>Sean’s <em>C++ Seasoning</em> (then Programming Converstaions <a href="https://www.youtube.com/watch?v=IzNtM038JuI" rel="noopener" target="_blank">#1</a> &amp; <a href="https://www.youtube.com/watch?v=vxv74Mjt9_0" rel="noopener" target="_blank">#2</a>) made me feel the same.<br>His talk reminded me, again, that I <em>have a lot to learn</em>.</p><p>One of the key points of his talk is that developers need to be familiar with the <a href="http://www.cplusplus.com/reference/algorithm/" rel="noopener" target="_blank">algorithm</a> library,<br>and be able to extend it. During his talk, He magically transformed a few-dozen-lines of complex code into two, using &lt;algorithm&gt;.</p><p>I’m used to seeing python code refactoring that turn huge pieces of code into a few, which are easy to read and reason about. But in C++? wow.</p><p>Anyway, one of my takeaways is that I don’t use &lt;algorithm&gt; enough. It’s time to change that.</p><h2 id="The-series"><a href="#The-series" class="headerlink" title="The  series"></a>The &lt;algorithm&gt; series</h2><p>I’ll go through every algorithm in [ C++’s <a href="http://www.cplusplus.com/reference/algorithm/" rel="noopener" target="_blank">stl</a>, Adobe’s <a href="https://github.com/stlab/adobe_source_libraries" rel="noopener" target="_blank">asl</a>, Google’s <a href="https://github.com/abseil/abseil-cpp" rel="noopener" target="_blank">abseil</a> &amp; <a href="http://www.boost.org/doc/libs/1_65_1/libs/algorithm/doc/html/index.html" rel="noopener" target="_blank">Boost</a> ] and will provide examples for each. I might even throw in some <a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-046j-introduction-to-algorithms-sma-5503-fall-2005/" rel="noopener" target="_blank">Introduction to Algorithms</a> references.</p><p>This is a big project which will take a very (very) long time to finish, but it’s worth it.</p><p><strong>Stay tuned.</strong></p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" class="a2a_dd article-share-link" data-a2a-title="C++ <algorithm> Series #0" data-a2a-url="https://oded.dev/2017/11/03/cpp-algo-0/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><article class="article article-type-post" id="post-doas-hello-world" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h1 itemprop="name"> <a href="/2017/10/21/doas-hello-world/" class="article-title">Everything that is wrong with sudo, and how I&#39;m planning to fix it</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/10/21/doas-hello-world/"><time datetime="2017-10-20T21:37:00.000Z" itemprop="datePublished">2017-10-21</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a href="/categories/programming/" class="article-category-link">programming</a></div><div class="article-tag"><i class="fa fa-tag"></i> <a href="/tags/c/" rel="tag" class="tag-link-link">c++</a>, <a href="/tags/project/" rel="tag" class="tag-link-link">project</a></div></div></header><div class="article-entry" itemprop="articleBody"><h1 align="center"> <a href="https://github.com/odedlaz/suex" rel="noopener" target="_blank"><img src="/images/2017/10/suex_xkcd.png" alt="suex" height="256" width="256"></a><br> <a href="https://github.com/odedlaz/suex" rel="noopener" target="_blank">suex</a></h1><p>The last few weeks have been a bit crazy.</p><p>I found myself re-implementing <a href="https://github.com/tianon/gosu" rel="noopener" target="_blank"><code>gosu</code></a> because it lacked features I needed: <a href="/2017/08/30/runas-tool/">sick of sudoers NOPASSWD?</a>.</p><p>Then, Even when I was done, I felt something was missing. <code>runas</code>, the tool I wrote, was half-way into becoming a <code>sudo</code> replacement and it bugged me I stopped mid way.</p><p>I looked around the web and found an amazing project called <code>doas</code> that is basically <code>runas</code> on steroids.</p><h2 id="What-is-doas"><a href="#What-is-doas" class="headerlink" title="What is doas"></a>What is doas</h2><p><em>doas</em> is a utility that is aimed to replace <em>sudo</em> for most ordinary use cases.<br>Ted Unagst’s, an OpenBSD developer, explained why He originally wrote it in his blog post: <a href="https://www.tedunangst.com/flak/post/doas" rel="noopener" target="_blank">doas - dedicated openbsd application subexecutor</a>.</p><p>The gist is that <code>sudo</code> is hard to configure and does a lot more then the standard user needs. <code>doas</code> was created in order to replace <code>sudo</code> for regular folks like me and you.<br>Moreover, <code>sudo</code> lacks ‘blacklist’ behaviour which is extremely useful at times.</p><p><code>doas</code> is relatively easy to configure, and an absolute joy compared to <code>sudo</code>. It’s also powerful enough for most daily use-cases.<br>IMO, the <code>permit</code> / <code>deny</code> concept of <code>doas</code> is so powerful that it’s enough to make the switch.</p><h2 id="Implementing-doas-from-scratch"><a href="#Implementing-doas-from-scratch" class="headerlink" title="Implementing doas from scratch"></a>Implementing doas from scratch</h2><p>The problem was that <code>doas</code> was written for <a href="https://www.openbsd.org/" rel="noopener" target="_blank">OpenBSD</a>.<br>I’m not running OpenBSD, so I looked around for a port.</p><p>All ports I found were half baked and poorly written.</p><p>Then I looked at the original source code, and decided I’m not going to port it.</p><p>Why? because it’s written in <code>C</code>, and I really don’t want to maintain <code>C</code> code.<br>Furthermore, the original code base lacked feature I introduced in <code>runas</code> which I really loved.</p><p>Instead, I decided to start this project. A complete re-implementation of <code>doas</code>.</p><p>This is my first attempt at writing a production quality, open source project from scratch.</p><p>I’m not there yet, but I’m determined on pushing this project into the main repositories of both <code>ubuntu</code> and <code>fedora</code>. More work has to be done in order to get there. for instance: Adding system tests &amp; Getting the code audited.</p><p>Feel free to reach out if you want to contribute!</p><h2 id="Project-Goals"><a href="#Project-Goals" class="headerlink" title="Project Goals"></a>Project Goals</h2><ul><li><p><strong><em>Secure</em></strong>. User’s shouldn’t be able to abuse the utility, and it should protect the user from making stupid mistakes.</p></li><li><p><strong>Easy</strong>. The utility should be easy to audit, to maintain, to extend and to contribute to.</p></li><li><p><strong><em>Friendly</em></strong>. Rule creation should be straight forward. Rule should be easy to understand and easy to debug.</p></li><li><p><strong><em>Powerful</em></strong>. Rules should be short, concise and allow find-grained control.</p></li><li><p><strong><em>Feature Parity</em></strong>. This project should have <em>complete</em> feature parity with the original utility.</p></li></ul><p>To achieve these goals, the following design decisions were made:</p><ol><li>The whole project was implemented in modern C++.</li><li>Explicit is better then implicit (for instance, rule commands must be absolute paths)</li><li>Prefer using the standard library when possible - for the sake of security and maintainability.</li><li>Commands are globs, which allows to use the same rule for many executables.</li><li>Arguments are PCRE-compliant regular expressions, which allows to create fine-grained rules.</li></ol><h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><p>You can find pre-compiled <code>.deb</code> and <code>.rpm</code> packages in the project’s <a href="https://github.com/odedlaz/suex/releases" rel="noopener" target="_blank">GitHub Releases Page</a>.</p><p><strong>[!]</strong> <a href="https://help.ubuntu.com/community/PPA" rel="noopener" target="_blank">Ubuntu PPA</a> &amp; <a href="https://docs.pagure.org/copr.copr/" rel="noopener" target="_blank">Fedora Copr</a> are coming soon.</p><p>You can also build from source. more information found at <a href="https://github.com/odedlaz/suex" rel="noopener" target="_blank"><code>odedlaz/suex</code></a>.</p><h2 id="Changes-compared-to-the-original"><a href="#Changes-compared-to-the-original" class="headerlink" title="Changes compared to the original"></a>Changes compared to the original</h2><h3 id="Security-checks"><a href="#Security-checks" class="headerlink" title="Security checks"></a>Security checks</h3><p><code>doas</code> doesn’t check the owners &amp; permissions of the binary and configuration file.<br><code>sudo</code> checks those, but only warns the user.</p><p>This version ensures the binary and configuration file are owned by <code>root:root</code>.<br>It also ensures the binary has <a href="https://en.wikipedia.org/wiki/Setuid" rel="noopener" target="_blank">setuid</a>, and that the configuration file has only read permissions.</p><p>Furthermore, only full paths of commands are allowed in the configuration file.<br>The idea is that privileged users (i.e: members of the <em>wheel</em> group) need to explicitly set the rule instead of depending on the running user’s path.</p><h3 id="Edit-mode"><a href="#Edit-mode" class="headerlink" title="Edit mode"></a>Edit mode</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">suex -E</span><br></pre></td></tr></table></figure><p><code>suex</code> allows any privileged user (i.e: members of the <em>wheel</em> group) to edit the configuration file safely.<br>Furthermore, if the configuration file is corrupted, privileged users can still access it and edit it.</p><p>The edit option is similar to <code>visudo</code>, it creates a copy of the configuration and updates the real configuration only when the copy is valid.</p><p>Non-privileged users are not allowed to edit the configuration.</p><h3 id="Verbose-mode"><a href="#Verbose-mode" class="headerlink" title="Verbose mode"></a>Verbose mode</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">suex -V</span><br></pre></td></tr></table></figure><p><code>suex</code> allows to show logging information to privileged users. That information shows which rules are being loaded &amp; how they are processed.</p><p>Non-privileged users are not allowed to turn on verbose mode.</p><h3 id="Dump-mode"><a href="#Dump-mode" class="headerlink" title="Dump mode"></a>Dump mode</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">suex -D</span><br></pre></td></tr></table></figure><p><code>suex</code> allows the user to dump the permissions it loaded to screen.<br>group permissions and command globs are expanded into individual rules as well.</p><p>privileged users see the permissions of all users instead of only their own.</p><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><p>Ted Unagst’s wrote a great blog post called <a href="https://www.tedunangst.com/flak/post/doas-mastery" rel="noopener" target="_blank">doas mastery</a>. Because the project has <em>complete feature parity</em> with the OpenBSD version, the mentioned post should be a good starting point.</p><p>Never the less, there are some powerful enhancments in this release that deserve special attention.</p><h3 id="fine-grained-package-management"><a href="#fine-grained-package-management" class="headerlink" title="fine-grained package management"></a>fine-grained package management</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deny odedlaz as root cmd &#x2F;usr&#x2F;bin&#x2F;dnf args (autoremove|update|upgrade).+</span><br><span class="line">permit keepenv nopass odedlaz as root cmd &#x2F;usr&#x2F;bin&#x2F;dnf args (autoremove|update|upgrade)$</span><br></pre></td></tr></table></figure><p>The first rule denies <code>odedlaz</code> of running <code>dnf</code> as <code>root</code> with any arguments that start with <code>autoremove</code>, <code>update</code> &amp; <code>upgrade</code> and have other arguments as well.</p><p>The second rule allows <code>odedlaz</code> to run <code>dnf</code> as <code>root</code> only with <code>autoremove</code>, <code>update</code>, <code>upgrade</code> and no other arguments.</p><p>These protect <code>odedlaz</code> from from accidentally running <code>dnf autoremove -y</code> or <code>dnf upgrade -y</code>, even if He’s a privileged user (a member of the <code>wheel</code> group).</p><p>On the other hand, it allows <code>odedlaz</code> to run these commands without a password (<code>nopass</code>) if they are executed without any trailing arguments.</p><h3 id="rm-rf-protection"><a href="#rm-rf-protection" class="headerlink" title="rm -rf protection"></a>rm -rf protection</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deny odedlaz as root cmd &#x2F;bin&#x2F;rm args .*\s+&#x2F;$</span><br></pre></td></tr></table></figure><p>The above rule protects <code>odedlaz</code> from accidentally running <code>rm -rf /</code> and the like.</p><h3 id="one-rule-multiple-executables"><a href="#one-rule-multiple-executables" class="headerlink" title="one rule, multiple executables"></a>one rule, multiple executables</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">permit keepenv nopass odedlaz as root cmd &#x2F;home&#x2F;odedlaz&#x2F;Development&#x2F;suex&#x2F;tools&#x2F;* args .*</span><br></pre></td></tr></table></figure><p>The above rule allows <code>odedlaz</code> to run any executable found at <code>/home/odedlaz/Development/suex/tools</code> with any arguments, as <code>root</code> without requiring a password.</p></div><footer class="article-footer"><div class="share-container"><a href="https://www.addtoany.com/share" rel="noopener" target="_blank" class="a2a_dd article-share-link" data-a2a-title="Everything that is wrong with sudo, and how I'm planning to fix it" data-a2a-url="https://oded.dev/2017/10/21/doas-hello-world/"><i class="fa fa-share"></i> Share</a></div></footer></div></article><nav id="page-nav"> <span class="page-number current">1</span><a href="/page/2/" class="page-number">2</a><a href="/page/3/" class="page-number">3</a><span class="space">&hellip;</span><a href="/page/10/" class="page-number">10</a><a href="/page/2/" rel="next" class="extend next">Next &raquo;</a></nav></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recent</h3><div class="widget"><ul class="no-thumbnail" id="recent-post"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/02/22/SSH-GlobalProtect/" class="title">Working from Home + Corporate VPN</a></p><p class="item-date"><time datetime="2021-02-22T17:30:03.000Z" itemprop="datePublished">2021-02-22</time></p></div></li><li><div class="item-inner"><p class="item-category"><a href="/categories/hacking/" class="article-category-link">hacking</a></p><p class="item-title"><a href="/2020/11/30/AX3600-1/" class="title">AX3600 - Post #1</a></p><p class="item-date"><time datetime="2020-11-30T19:08:00.000Z" itemprop="datePublished">2020-11-30</time></p></div></li><li><div class="item-inner"><p class="item-category"><a href="/categories/hacking/" class="article-category-link">hacking</a></p><p class="item-title"><a href="/2020/10/23/AX3600-0/" class="title">AX3600 - Post #0</a></p><p class="item-date"><time datetime="2020-10-23T13:34:10.000Z" itemprop="datePublished">2020-10-23</time></p></div></li><li><div class="item-inner"><p class="item-category"><a href="/categories/devops/" class="article-category-link">devops</a></p><p class="item-title"><a href="/2018/01/12/wips_weather/" class="title">Getting an Accurate Weather Forecast using Wi-Fi Position System</a></p><p class="item-date"><time datetime="2018-01-12T21:01:09.000Z" itemprop="datePublished">2018-01-12</time></p></div></li><li><div class="item-inner"><p class="item-category"><a href="/categories/thoughts/" class="article-category-link">thoughts</a><i class="fa fa-angle-right"></i><a href="/categories/thoughts/programming/" class="article-category-link">programming</a></p><p class="item-title"><a href="/2017/11/28/not_an_lang_dev/" class="title">You&#39;re not a Java Developer</a></p><p class="item-date"><time datetime="2017-11-28T08:53:00.000Z" itemprop="datePublished">2017-11-28</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tag cloud</h3><div class="widget tagcloud"> <a href="/tags/netcore/" style="font-size:10px">.netcore</a> <a href="/tags/algorithm/" style="font-size:10px">algorithm</a> <a href="/tags/assembly/" style="font-size:11.11px">assembly</a> <a href="/tags/awk/" style="font-size:10px">awk</a> <a href="/tags/ax3600/" style="font-size:11.11px">ax3600</a> <a href="/tags/bash/" style="font-size:12.22px">bash</a> <a href="/tags/byobu/" style="font-size:10px">byobu</a> <a href="/tags/c/" style="font-size:14.44px">c</a> <a href="/tags/c/" style="font-size:15.56px">c++</a> <a href="/tags/concurrency/" style="font-size:12.22px">concurrency</a> <a href="/tags/cybereason/" style="font-size:11.11px">cybereason</a> <a href="/tags/data-structures/" style="font-size:10px">data-structures</a> <a href="/tags/databases/" style="font-size:10px">databases</a> <a href="/tags/debian/" style="font-size:10px">debian</a> <a href="/tags/devops/" style="font-size:10px">devops</a> <a href="/tags/digitalocean/" style="font-size:11.11px">digitalocean</a> <a href="/tags/direnv/" style="font-size:11.11px">direnv</a> <a href="/tags/docker/" style="font-size:11.11px">docker</a> <a href="/tags/fingerprint/" style="font-size:10px">fingerprint</a> <a href="/tags/ghost/" style="font-size:13.33px">ghost</a> <a href="/tags/gici/" style="font-size:11.11px">gici</a> <a href="/tags/gnome/" style="font-size:10px">gnome</a> <a href="/tags/golang/" style="font-size:14.44px">golang</a> <a href="/tags/h-264/" style="font-size:10px">h.264</a> <a href="/tags/hackathon/" style="font-size:11.11px">hackathon</a> <a href="/tags/hexo/" style="font-size:11.11px">hexo</a> <a href="/tags/idiom/" style="font-size:13.33px">idiom</a> <a href="/tags/language-server-protocol/" style="font-size:10px">language-server-protocol</a> <a href="/tags/linux/" style="font-size:18.89px">linux</a> <a href="/tags/lsp/" style="font-size:10px">lsp</a> <a href="/tags/math/" style="font-size:10px">math</a> <a href="/tags/neovim/" style="font-size:10px">neovim</a> <a href="/tags/networking/" style="font-size:10px">networking</a> <a href="/tags/ocr/" style="font-size:10px">ocr</a> <a href="/tags/optimization/" style="font-size:13.33px">optimization</a> <a href="/tags/pgp/" style="font-size:10px">pgp</a> <a href="/tags/productivity/" style="font-size:17.78px">productivity</a> <a href="/tags/project/" style="font-size:16.67px">project</a> <a href="/tags/python/" style="font-size:20px">python</a> <a href="/tags/regex/" style="font-size:10px">regex</a> <a href="/tags/screen/" style="font-size:10px">screen</a> <a href="/tags/tmux/" style="font-size:12.22px">tmux</a> <a href="/tags/tor/" style="font-size:10px">tor</a> <a href="/tags/vim/" style="font-size:12.22px">vim</a> <a href="/tags/vscode/" style="font-size:10px">vscode</a> <a href="/tags/web-scraping/" style="font-size:10px">web-scraping</a> <a href="/tags/xiaomi/" style="font-size:11.11px">xiaomi</a></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a href="/categories/announcement/" class="category-list-link">announcement</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a href="/categories/announcement/blog/" class="category-list-link">blog</a><span class="category-list-count">3</span></li><li class="category-list-item"><a href="/categories/announcement/general/" class="category-list-link">general</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a href="/categories/devops/" class="category-list-link">devops</a><span class="category-list-count">26</span><ul class="category-list-child"><li class="category-list-item"><a href="/categories/devops/programming/" class="category-list-link">programming</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a href="/categories/general/" class="category-list-link">general</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a href="/categories/general/book/" class="category-list-link">book</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a href="/categories/hacking/" class="category-list-link">hacking</a><span class="category-list-count">2</span></li><li class="category-list-item"><a href="/categories/new-years-resolution/" class="category-list-link">new-years-resolution</a><span class="category-list-count">1</span></li><li class="category-list-item"><a href="/categories/programming/" class="category-list-link">programming</a><span class="category-list-count">50</span><ul class="category-list-child"><li class="category-list-item"><a href="/categories/programming/infosec/" class="category-list-link">infosec</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a href="/categories/thoughts/" class="category-list-link">thoughts</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a href="/categories/thoughts/devops/" class="category-list-link">devops</a><span class="category-list-count">1</span></li><li class="category-list-item"><a href="/categories/thoughts/general/" class="category-list-link">general</a><span class="category-list-count">1</span></li><li class="category-list-item"><a href="/categories/thoughts/infosec/" class="category-list-link">infosec</a><span class="category-list-count">4</span></li><li class="category-list-item"><a href="/categories/thoughts/programming/" class="category-list-link">programming</a><span class="category-list-count">1</span></li></ul></li></ul></div></div><div class="fa fa-angle-up" id="toTop"></div></aside></div><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"> <input class="ins-search-input" placeholder="Type something..."><span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><footer id="footer"><div class="outer"><div class="inner" id="footer-info"> Copyright &copy; 2021 Oded Lazar. All Right Reserved.</div></div></footer></div><script src="/js/jquery-2.2.4.min.js"></script><script>var a2a_config=a2a_config||{};a2a_config.onclick=0,a2a_config.prioritize=["linkedin","twitter","reddit","hacker_news","facebook","google_plus","whatsapp","pocket"]</script><script src="https://static.addtoany.com/menu/page.js" async></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/bootstrap.js"></script></body></html>