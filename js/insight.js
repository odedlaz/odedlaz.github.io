var run=function(i,s){var e=i(".ins-search"),n=e.find(".ins-search-input"),o=e.find(".ins-section-wrapper"),c=e.find(".ins-section-container");function a(n,t,e,r,a){return i("<div>").addClass("ins-selectable").addClass("ins-search-item").append(i("<header>").append(i("<i>").addClass("fa").addClass("fa-"+n)).append(null!=t&&""!=t?t:s.TRANSLATION.UNTITLED).append(e?i("<span>").addClass("ins-slug").text(e):null)).append(r?i("<p>").addClass("ins-search-preview").text((e=r,(r=document.createElement("textarea")).innerHTML=e,r.value)):null).attr("data-url",a)}function r(t,n){var e,r;if(0===n.length)return null;switch(r=s.TRANSLATION[t],t){case"POSTS":case"PAGES":e=n.map(function(n){return a("file",n.title,null,null,s.ROOT_URL+n.path)});break;case"CATEGORIES":case"TAGS":e=n.map(function(n){return a("CATEGORIES"===t?"folder":"tag",n.name,n.slug,null,n.permalink)});break;default:return null}return r=r,i("<section>").addClass("ins-section").append(i("<header>").addClass("ins-section-header").text(r)).append(e)}function u(n,t){var e={};n.pages.concat(n.posts).forEach(function(n){n[t]&&n[t].forEach(function(n){e[n.name]=n})});var r=[];for(t in e)r.push(e[t]);return r}function l(n){return n.split(" ").filter(function(n){return!!n}).map(function(n){return n.toUpperCase()})}function f(n,e,r){n=l(n);return n.filter(function(t){return 0<r.filter(function(n){return!!e.hasOwnProperty(n)&&(-1<e[n].toUpperCase().indexOf(t)||void 0)}).length}).length===n.length}function p(n,r,t,a){var i=0;return l(n).forEach(function(n){var e=new RegExp(n,"img");t.forEach(function(n,t){r.hasOwnProperty(n)&&(n=r[n].match(e),i+=n?n.length*a[t]:0)})}),i}function d(n,t){var e,r,a={POST:function(n){return p(e,n,["title","text"],[3,1])},PAGE:function(n){return p(e,n,["title","text"],[3,1])},CATEGORY:function(n){return p(e,n,["name","slug"],[1,1])},TAG:function(n){return p(e,n,["name","slug"],[1,1])}},i=(r=e=t,{POST:function(n){return f(r,n,["title","text"])},PAGE:function(n){return f(r,n,["title","text"])},CATEGORY:function(n){return f(r,n,["name","slug"])},TAG:function(n){return f(r,n,["name","slug"])}}),s=n.posts,o=n.pages,t=u(n,"tags"),n=u(n,"categories");return{posts:s.filter(i.POST).sort(function(n,t){return a.POST(t)-a.POST(n)}).slice(0,5),pages:o.filter(i.PAGE).sort(function(n,t){return a.PAGE(t)-a.PAGE(n)}).slice(0,5),categories:n.filter(i.CATEGORY).sort(function(n,t){return a.CATEGORY(t)-a.CATEGORY(n)}).slice(0,5),tags:t.filter(i.TAG).sort(function(n,t){return a.TAG(t)-a.TAG(n)}).slice(0,5)}}function t(n){var t=i.makeArray(c.find(".ins-selectable")),e=-1;t.forEach(function(n,t){i(n).hasClass("active")&&(e=t)});var r,a=(t.length+e+n)%t.length;i(t[e]).removeClass("active"),i(t[a]).addClass("active"),0!==(r=i(t[a])).length&&(n=o[0].clientHeight,t=r.position().top-o.scrollTop(),(a=r[0].clientHeight+r.position().top)>n+o.scrollTop()&&o.scrollTop(a-o[0].clientHeight),t<0&&o.scrollTop(r.position().top))}function h(n){n&&n.length&&(location.href=n.attr("data-url"))}e.parent().remove(".ins-search"),i("body").append(e),i.getJSON(s.CONTENT_URL,function(t){"#ins-search"===location.hash.trim()&&e.addClass("show"),n.on("input",function(){var n=i(this).val();!function(n){for(var t in c.empty(),n)c.append(r(t.toUpperCase(),n[t]))}(d(t,n))}),n.trigger("input")}),i(document).on("click focus",".search-form-input",function(){e.addClass("show"),e.find(".ins-search-input").focus()}).on("click",".ins-search-item",function(){h(i(this))}).on("click",".ins-close",function(){e.removeClass("show")}).on("keydown",function(n){if(e.hasClass("show"))switch(n.keyCode){case 27:e.removeClass("show");break;case 38:t(-1);break;case 40:t(1);break;case 13:h(c.find(".ins-selectable.active").eq(0))}})};exports.run=run;